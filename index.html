<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC Schedule Sorter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HTML2CANVAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
 <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&family=Gloria+Hallelujah&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">


<!-- PDF.js (Matched Versions) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>



    <script>


   tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                        // NEW FONTS ADDED HERE:
                        hand: ['"Gloria Hallelujah"', 'cursive'],
                        cyber: ['"Orbitron"', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'bounce-slow': 'bounce 3s infinite', // Added for the floating button
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }






        
    </script>
  <style>
    /* --- 1. GLOBAL & AMBIENT GLOW --- */
    body { background-color: #030712; color: white; overflow-x: hidden; font-family: 'Plus Jakarta Sans', sans-serif; }
    :root { --theme-primary: #3b82f6; --theme-secondary: #a855f7; }

    .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .shape { position: absolute; filter: blur(100px); opacity: 0.4; animation: blob 10s infinite alternate; }
    .shape-1 { top: -10%; left: -10%; width: 600px; height: 600px; background: var(--theme-primary); }
    .shape-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: var(--theme-secondary); }

    /* --- 2. BUTTONS VISIBILITY FIX --- */
    .glass-btn { 
        background: rgba(255, 255, 255, 0.1) !important; 
        border: 1px solid rgba(255, 255, 255, 0.2) !important; 
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    .glass-btn:hover { background: rgba(255, 255, 255, 0.2) !important; border-color: white !important; }

    /* --- 3. THE ARTBOARD --- */
    #scheduleContainer {
        margin: 0 auto !important;
        background-color: rgba(3, 7, 18, 0.4); 
        position: relative;
        display: block !important; 
        transition: width 0.3s ease;
        box-sizing: border-box;
        padding: 25px;
        border-radius: 32px;
    }

    /* --- 4. CARDS (Large Text Fix) --- */
    .card-draggable { 
        padding: 16px !important;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    /* SUBJECT NAME: Increased to 16px for clarity */
    .card-draggable h4 {
        font-size: 16px !important;
        font-weight: 800 !important;
        letter-spacing: -0.02em;
        line-height: 1.2;
        margin: 8px 0 !important;
        white-space: normal !important;
    }

    /* EDP TAG: Increased to 12px */
    .edp-tag {
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px !important;
        font-weight: 800;
        padding: 4px 10px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* INFO TEXT (Time/Room): 13px */
    .info-text { font-size: 13px !important; font-weight: 500; opacity: 1 !important; }

    .day-header { border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px; }
    .card-grid { display: grid !important; gap: 15px; align-items: stretch; }

















    /* Dynamic Header Glow */
.header-glow {
    text-shadow: 0 0 30px var(--theme-primary);
    transition: all 0.5s ease;
}

/* Dynamic Generate Button */
#genBtn {
    background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary)) !important;
    box-shadow: 0 10px 20px -10px var(--theme-primary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

#genBtn:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 20px 40px -10px var(--theme-primary);
}

#genBtn:active {
    transform: scale(0.95);
}

/* Smooth Title Gradient */
.text-gradient {
    background: linear-gradient(to right, var(--theme-primary), var(--theme-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    transition: all 0.8s ease;
}
</style>



</head>
<body class="selection:bg-indigo-500 selection:text-white min-h-screen flex flex-col">

    <div class="ambient-light">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <!-- Main Content Wrapper -->
    <main class="flex-grow max-w-7xl mx-auto px-4 py-10 md:py-16 w-full">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6 animate-fade-up">
            <div class="relative">
                <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight mb-2">
                    Study Load <br> <span class="text-gradient header-glow">Sorter AI</span>
                </h1>
                <p class="text-slate-400 font-light text-lg">Paste text. Choose design. Save image.</p>
            </div>
            
<!-- PDF UPLOAD BUTTON -->
      <label class="cursor-pointer glass-btn px-5 py-3 rounded-full flex items-center gap-2 group">
                <i class="fa-solid fa-file-pdf text-red-500"></i>
                <span id="pdfLabel" class="text-sm font-semibold tracking-wide text-slate-300 group-hover:text-white">Upload PDF</span>
                <input type="file" id="pdfUpload" accept=".pdf" class="hidden" onchange="handlePDF(this)">
            </label>



            <div class="flex gap-3">
                <button onclick="toggleVideo()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2 group">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <span class="text-sm font-semibold tracking-wide text-slate-300 group-hover:text-white">Watch Tutorial</span>
                </button>
                <button onclick="loadExample()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2">
                    <i class="fa-solid fa-code text-blue-400"></i>
                    <span class="text-sm font-semibold tracking-wide text-slate-300">Sample</span>
                </button>
            </div>
        </header>

        <!-- Input Section -->
        <div class="glass-panel rounded-3xl p-1 mb-16 animate-fade-in">
            <div class="bg-[#0f172a]/60 rounded-[20px] p-6 md:p-10 relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>

                <div class="flex justify-between items-center mb-4">
                    <label class="text-xs font-bold uppercase tracking-[0.2em] text-slate-400">Paste Schedule Table</label>
                    <div class="flex gap-2">
                        <button onclick="clearData()" class="text-[10px] bg-red-500/10 border border-red-500/30 text-red-400 px-3 py-1 rounded hover:bg-red-500/20 transition">
                            <i class="fa-solid fa-trash"></i> Clear
                        </button>
                        <div class="text-[10px] bg-slate-800 border border-slate-700 px-2 py-1 rounded text-slate-400 font-mono">
                            CTRL + V
                        </div>
                    </div>
                </div>

                <textarea id="rawInput" class="w-full h-40 bg-transparent resize-none text-sm md:text-base font-mono text-slate-200 placeholder-slate-600 border-b border-slate-700 focus:border-blue-500 transition-colors" 
                placeholder="Paste directly from your study load...&#10;41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM"></textarea>

                <div class="mt-8 flex justify-end">
                    <button id="genBtn" onclick="processSchedule()" class="relative overflow-hidden text-white font-black py-4 px-12 rounded-2xl transition-all uppercase tracking-widest group">
    <span class="relative z-10 flex items-center gap-3">
        Generate <i class="fa-solid fa-bolt animate-pulse"></i>
    </span>
</button>
                </div>
            </div>
        </div>

        <!-- CONTROL BAR (Design & Department) -->
        <div id="toolbar" class="hidden mb-8 animate-fade-in">
            <div class="glass-panel p-4 rounded-xl flex flex-col xl:flex-row justify-between items-center gap-4">
                
                <!-- Department Theme -->
                <div class="flex items-center gap-2 w-full xl:w-auto">
                    <span class="text-xs font-bold text-slate-400 uppercase">Dept:</span>
                    <select id="deptSelect" onchange="changeTheme(this.value)" class="bg-slate-800 text-white text-sm rounded-lg p-2 border border-slate-600 focus:ring-blue-500 focus:border-blue-500 flex-1">
                        <option value="BSIT">BSIT / CCS</option>
                        <option value="MARITIME">Maritime</option>
                        <option value="ENGINEERING">Engineering</option>
                        <option value="CUSTOMS">Customs</option>
                        <option value="EDUCATION">Education</option>
                    </select>
                </div>

                <!-- Design Picker -->
                <div class="flex items-center gap-2 w-full xl:w-auto bg-slate-900/50 p-1 rounded-lg">


<div class="flex items-center gap-2 w-full xl:w-auto bg-slate-900/50 p-1 rounded-lg">
    <button onclick="setLayout('desktop')" id="btn-mode-pc" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow">
        Desktop View
    </button>
    <button onclick="setLayout('mobile')" id="btn-mode-mobile" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white">
        Mobile Designer
    </button>
</div>

                    <button onclick="setDesign('glass')" id="btn-glass" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow">
                        <i class="fa-regular fa-gem mr-1"></i> Glass
                    </button>
                    <button onclick="setDesign('paper')" id="btn-paper" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white">
                        <i class="fa-regular fa-file-lines mr-1"></i> Paper
                    </button>
                  
                </div>

           <!-- ADVANCED WALLPAPER DESIGNER -->
<div id="layoutControls" class="hidden flex flex-col gap-4 w-full xl:w-auto bg-slate-900/90 p-5 rounded-3xl border border-white/10 backdrop-blur-xl mb-6">
    <!-- 1. Layout Density -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Layout Density</label>
        <div class="flex bg-black/40 p-1 rounded-xl gap-1">
            <button onclick="changeDensity(1)" id="den-1" class="flex-1 py-1.5 text-[10px] font-bold rounded-lg text-slate-400">List</button>
            <button onclick="changeDensity(2)" id="den-2" class="flex-1 py-1.5 text-[10px] font-bold rounded-lg bg-blue-600 text-white shadow">Grid</button>
        </div>
    </div>
    <!-- 2. Card Size -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Zoom Cards</label>
        <input type="range" min="0.5" max="1" step="0.05" value="0.9" class="cursor-pointer accent-emerald-500" oninput="adjustCanvas('scale', this.value)">
    </div>
    <!-- 3. Canvas Width -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Wallpaper Width</label>
        <input type="range" min="350" max="600" value="450" class="cursor-pointer accent-purple-500" oninput="adjustCanvas('width', this.value)">
    </div>
    <!-- 4. Clock Space -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Top Space (Clock)</label>
        <input type="range" min="0" max="300" value="80" class="cursor-pointer accent-blue-500" oninput="adjustCanvas('top', this.value)">
    </div>
</div>




                <!-- Download -->
                <button onclick="downloadImage()" class="w-full xl:w-auto bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center justify-center gap-2 transition">
                    <i class="fa-solid fa-download"></i> Save Image
                </button>
            </div>
        </div>

        <!-- Output Grid (The part that gets saved) -->
        <div id="scheduleContainer" class="p-4 rounded-2xl bg-[#030712] relative transition-colors duration-500">
            <div id="resultArea" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 pb-8">
                <!-- Columns injected by JS -->
            </div>

            <!-- WATERMARK -->
            <div id="watermark" class="hidden text-center pt-6 border-t border-slate-800/50 mt-4">
                <p class="text-[10px] text-slate-500 font-mono uppercase tracking-widest">
                    <i class="fa-solid fa-microchip mr-1"></i> Powered by CMOB Department
                </p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-20 opacity-30 animate-pulse">
            <i class="fa-solid fa-layer-group text-6xl mb-4 text-slate-400"></i>
            <p class="text-slate-400 text-sm tracking-widest uppercase">Waiting for data...</p>
        </div>

    </main>






 <!-- NEW: FLOATING CUSTOMIZE BUTTON -->
    <button id="fabCustomize" onclick="openTemplateModal()" class="hidden fixed bottom-6 right-6 w-14 h-14 bg-purple-600 hover:bg-purple-500 text-white rounded-full shadow-2xl z-50 flex items-center justify-center text-xl transition hover:scale-110 active:scale-90 animate-bounce">
        <i class="fa-solid fa-palette"></i>
    </button>

   <!-- TEMPLATE GALLERY MODAL (Final Unified Version) -->
<div id="templateModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/95 backdrop-blur-md p-4 animate-fade-in">
    <!-- Overlay Click to Close -->
    <div class="absolute inset-0" onclick="closeTemplateModal()"></div>
    
    <!-- Modal Container -->
    <div class="bg-[#0f172a] w-full max-w-6xl h-[85vh] rounded-3xl flex flex-col relative z-10 border border-slate-700 shadow-2xl overflow-hidden">
        
        <!-- Modal Header (Fixed) -->
        <div class="p-5 border-b border-slate-700/50 flex justify-between items-center bg-[#020617] shrink-0 z-20">
            <div>
                <h3 class="font-bold text-xl text-white tracking-tight">Select a Design Style</h3>
                <p class="text-xs text-slate-400 mt-1">Scroll to view all themes.</p>
            </div>
            <button onclick="closeTemplateModal()" class="w-10 h-10 rounded-full bg-slate-800 text-slate-400 hover:text-white hover:bg-red-500/20 hover:border-red-500 transition-all flex items-center justify-center">
                <i class="fa-solid fa-xmark text-lg"></i>
            </button>
        </div>
        
        <!-- Modal Body (Scrollable) -->
        <div class="flex-1 overflow-y-auto p-4 sm:p-6 bg-[#020617] scroll-smooth">
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5 pb-10">

                <!-- 1. MARITIME (Signature Blue & White) -->
                <div onclick="setDesign('maritime')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl border-2 border-white bg-[#0a192f] shadow-lg hover:shadow-[0_0_30px_rgba(56,189,248,0.5)] hover:border-[#fbbf24] transition-all duration-500">
                    <div class="absolute inset-0 bg-gradient-to-br from-[#02040a] to-[#1e3a8a]"></div>
                    <div class="absolute -top-8 -right-8 text-white/10 text-8xl group-hover:rotate-180 transition-transform duration-[1.5s]"><i class="fa-solid fa-compass"></i></div>
                    <div class="absolute top-4 left-4 text-[#fbbf24] text-xs animate-pulse"><i class="fa-solid fa-star"></i></div>
                    <div class="absolute bottom-10 right-10 text-white/20 text-sm"><i class="fa-solid fa-star"></i></div>
                    <div class="absolute bottom-0 left-0 w-full text-blue-300/20 text-5xl leading-none opacity-50 group-hover:-translate-y-1 transition-transform duration-1000"><i class="fa-solid fa-water"></i></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-white">
                        <div class="mb-2 bg-white p-2.5 rounded-full border-4 border-[#0a192f] ring-2 ring-[#fbbf24] shadow-xl group-hover:scale-110 transition-transform"><i class="fa-solid fa-anchor text-2xl text-[#0a192f]"></i></div>
                        <span class="font-black text-lg uppercase tracking-[0.2em] font-serif drop-shadow-md">Navigator</span>
                        <div class="mt-1 flex items-center gap-2 bg-[#0a192f] px-3 py-1 rounded-full border border-[#fbbf24]">
                            <div class="w-2 h-2 rounded-full bg-[#fbbf24]"></div><span class="text-[9px] text-white font-bold uppercase">Suggest Karl Alme√±ana</span><div class="w-2 h-2 rounded-full bg-[#fbbf24]"></div>
                        </div>
                    </div>
                </div>

                <!-- 2. AZURE PRO (Aesthetic Blue) -->
                <div onclick="setDesign('azure')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl shadow-lg transition-all duration-300 hover:scale-[1.02] hover:shadow-cyan-500/50 hover:ring-2 ring-cyan-400">
                    <div class="absolute inset-0 bg-gradient-to-br from-[#0f172a] via-[#1e40af] to-[#38bdf8]"></div>
                    <div class="absolute top-2 right-2 text-white/20 text-xl group-hover:rotate-12 transition-transform"><i class="fa-solid fa-moon"></i></div>
                    <div class="absolute bottom-2 left-2 text-white/20 text-lg group-hover:-translate-y-1 transition-transform"><i class="fa-solid fa-cloud"></i></div>
                    <div class="absolute top-1/2 right-1/4 text-white/10 text-4xl"><i class="fa-solid fa-star"></i></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-white">
                        <div class="bg-white/20 p-2 rounded-full mb-1 backdrop-blur-sm border border-white/30"><i class="fa-regular fa-gem text-xl text-cyan-100 drop-shadow-md"></i></div>
                        <span class="font-black text-lg tracking-wider drop-shadow-md font-sans">AZURE BLUE</span>
                        <span class="text-[9px] mt-1 bg-gradient-to-r from-blue-500 to-cyan-500 px-3 py-0.5 rounded-full text-white font-bold border border-white/20 shadow-sm"><i class="fa-solid fa-heart text-[8px] mr-1 text-pink-300"></i> by Shane Herbieto</span>
                    </div>
                </div>

                <!-- 3. COSMIC GLASS (Default) -->
                <div onclick="setDesign('cosmic')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl border border-blue-500/30 shadow-lg hover:shadow-blue-500/50 transition-all duration-300">
                    <div class="absolute inset-0 bg-[#030712]"></div>
                    <div class="absolute -top-10 -left-10 w-24 h-24 bg-blue-600/30 rounded-full blur-2xl group-hover:bg-purple-600/40 transition-colors"></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-white">
                        <i class="fa-solid fa-satellite text-2xl mb-2 text-slate-300 group-hover:rotate-12 transition-transform"></i>
                        <span class="font-bold text-lg tracking-wider">COSMIC</span>
                        <span class="text-[9px] text-slate-400 mt-1">Default Dark Mode</span>
                    </div>
                </div>

                <!-- 4. CLEAN PAPER -->
                <div onclick="setDesign('paper')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl bg-white border border-gray-300 hover:ring-2 ring-gray-400 transition shadow-lg">
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-gray-800">
                        <i class="fa-regular fa-file-lines text-2xl mb-2 text-slate-400 group-hover:text-slate-800 transition-colors"></i>
                        <span class="font-bold text-lg tracking-tight font-serif">Clean Paper</span>
                        <p class="text-[9px] text-slate-400 mt-1 uppercase tracking-widest">Minimalist Light</p>
                    </div>
                </div>

                <!-- 5. CYBERPUNK -->
                <div onclick="setDesign('cyber')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden bg-black border border-green-800 hover:border-green-400 transition-all duration-300 rounded-xl">
                    <div class="absolute inset-0 bg-[linear-gradient(rgba(18,16,16,0)_50%,rgba(0,0,0,0.25)_50%),linear-gradient(90deg,rgba(255,0,0,0.06),rgba(0,255,0,0.02),rgba(0,0,255,0.06))] z-0 bg-[length:100%_4px,3px_100%] pointer-events-none"></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-green-500 font-mono">
                        <i class="fa-solid fa-terminal text-2xl mb-2 group-hover:animate-pulse"></i>
                        <span class="font-bold text-lg tracking-widest uppercase group-hover:text-green-400">CYBER.SYS</span>
                        <span class="text-[9px] bg-green-900/20 px-2 py-0.5 mt-1 border border-green-500/30 group-hover:bg-green-500 group-hover:text-black transition-colors">>> EXECUTE</span>
                    </div>
                </div>

                <!-- 6. SKETCHBOOK -->
                <div onclick="setDesign('notebook')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl border-2 border-yellow-600/20 bg-[#fef9c3] hover:border-yellow-600 transition-all duration-300">
                    <div class="absolute inset-0" style="background-image: linear-gradient(#cbd5e1 1px, transparent 1px); background-size: 100% 20px; opacity: 0.5;"></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-yellow-900 font-hand rotate-1 group-hover:rotate-0 transition-transform">
                        <i class="fa-solid fa-pencil text-2xl mb-2"></i>
                        <span class="font-bold text-xl">Sketchbook</span>
                        <span class="text-[9px] font-sans text-slate-500 mt-1">Handwritten Style</span>
                    </div>
                </div>

                <!-- 7. BLUEPRINT -->
                <div onclick="setDesign('blueprint')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl bg-[#1e3a8a] border-2 border-white/20 hover:border-white transition-all duration-300">
                    <div class="absolute inset-0 opacity-20" style="background-image: radial-gradient(white 1px, transparent 1px); background-size: 10px 10px;"></div>
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-white font-mono">
                        <i class="fa-solid fa-ruler-combined text-2xl mb-2"></i>
                        <span class="font-bold text-lg uppercase border-b-2 border-white/50 pb-1">Blueprint</span>
                        <span class="text-[8px] mt-2 opacity-70">ARCH.V.2.0</span>
                    </div>
                </div>

                <!-- 8. STEALTH -->
                <div onclick="setDesign('stealth')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl bg-[#171717] border border-neutral-700 hover:border-neutral-400 transition-all duration-300">
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-neutral-400 group-hover:text-white">
                        <i class="fa-solid fa-user-secret text-2xl mb-2"></i>
                        <span class="font-bold text-lg tracking-widest uppercase">STEALTH</span>
                        <span class="text-[9px] mt-1 opacity-50">Tactical Dark</span>
                    </div>
                </div>

                <!-- 9. SOFT ROSE -->
                <div onclick="setDesign('rose')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl bg-[#fff1f2] border-2 border-transparent hover:border-pink-300 transition-all duration-300 shadow-sm hover:shadow-pink-200">
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-pink-500">
                        <i class="fa-solid fa-heart text-2xl mb-2 text-pink-300 group-hover:scale-110 transition-transform"></i>
                        <span class="font-bold text-lg font-serif italic tracking-wide">Soft Rose</span>
                        <span class="text-[9px] bg-pink-100 px-3 py-1 rounded-full mt-1 text-pink-400 font-medium group-hover:bg-pink-200"><i class="fa-solid fa-ribbon text-[8px] mr-1"></i> Aesthetic</span>
                    </div>
                </div>

                <!-- 10. MODERN PRO -->
                <div onclick="setDesign('pro')" class="shrink-0 h-40 cursor-pointer group relative overflow-hidden rounded-xl bg-slate-50 border-t-4 border-indigo-600 hover:shadow-xl transition-all duration-300">
                    <div class="h-full flex flex-col items-center justify-center relative z-10 text-slate-700">
                        <div class="bg-indigo-100 p-2 rounded-lg mb-2 group-hover:bg-indigo-600 group-hover:text-white transition-colors"><i class="fa-solid fa-briefcase text-lg"></i></div>
                        <span class="font-bold text-lg">Modern Pro</span>
                        <span class="text-[9px] text-slate-400 mt-1">Clean Professional</span>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>













    <!-- FOOTER -->
    <footer class="border-t border-slate-800/50 py-8 bg-[#020617] relative z-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-sm font-medium">
                Powered by 
                <span class="ml-1 font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                    <i class="fa-solid fa-microchip mr-1"></i> CMOB Department
                </span>
            </p>
            <p class="text-[10px] text-slate-600 mt-2 font-mono">&copy; 2026. Built for UC Students.</p>
        </div>
    </footer>

    <!-- VIDEO MODAL -->
    <div id="videoModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md p-4 transition-opacity duration-300">
        <div class="absolute inset-0" onclick="toggleVideo()"></div>
        <div class="glass-panel w-full max-w-4xl rounded-2xl overflow-hidden relative z-10">
            <div class="flex justify-between items-center p-5 border-b border-white/10 bg-white/5">
                <h3 class="font-bold text-white">How to Use</h3>
                <button onclick="toggleVideo()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="flex p-2 bg-slate-900/50 gap-2 border-b border-white/5">
                <button onclick="switchTab('mobile')" id="btn-mobile" class="glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg">Mobile</button>
                <button onclick="switchTab('desktop')" id="btn-desktop" class="glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg">Desktop</button>
            </div>
            <div class="p-4 bg-black/40">
                <div id="view-mobile">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-mobile" class="w-full h-full object-contain" controls playsinline>
                            <source src="mon.mp4" type="video/mp4">
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Open PDF > Copy Text > Paste Here.</p>
                </div>
                <div id="view-desktop" class="hidden">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-desktop" class="w-full h-full object-contain" controls playsinline>
                            <source src="2026-01-20 12-21-41.mp4" type="video/mp4">
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Portal > Copy (Ctrl+C) > Paste (Ctrl+V).</p>
                </div>
            </div>
        </div>
    </div>

        <script>
    // --- GLOBAL STATE ---
    let currentTemplate = 'cosmic';
    let parsedData = { mwf: [], tth: [], sat: [] };
    let studentName = "UC Student";
    let canvasSettings = { width: 420, cols: 2, scale: 0.9, top: 80, mode: 'desktop' };

    const themes = {
        BSIT: { primary: '#3b82f6', secondary: '#a855f7', button: 'bg-blue-600' },
        MARITIME: { primary: '#0ea5e9', secondary: '#1e3a8a', button: 'bg-sky-600' },
        ENGINEERING: { primary: '#f97316', secondary: '#dc2626', button: 'bg-orange-600' },
        CUSTOMS: { primary: '#10b981', secondary: '#0f766e', button: 'bg-emerald-600' },
        EDUCATION: { primary: '#ec4899', secondary: '#be123c', button: 'bg-pink-600' }
    };

    // --- DESIGN ENGINE ---
    function setDesign(style) {
        if (style === 'glass') style = 'cosmic';
        currentTemplate = style;
        
        // Update Indicator
        ['glass', 'paper'].forEach(id => {
            const btn = document.getElementById(`btn-${id}`);
            if (btn) btn.className = (id === style || (id === 'glass' && style === 'cosmic')) ? 
                "flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow" : 
                "flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400";
        });

        updateContainerStyle(style);
        renderAll();
        if(typeof closeTemplateModal === 'function') closeTemplateModal();
    }

    function applyTemplate(style) { setDesign(style); }

    function updateContainerStyle(style) {
        const container = document.getElementById('scheduleContainer');
        const watermark = document.getElementById('watermark');
        const blobs = document.querySelector('.ambient-light');

        container.style = ""; 
        container.className = "p-4 rounded-2xl relative overflow-hidden transition-all duration-500";
        if (blobs) blobs.style.display = 'block';


// 1. COSMIC (Default) - Kept mostly same, just smoother
    if (style === 'cosmic' || style === 'glass') {
        container.style.backgroundColor = '#030712';
        container.style.backgroundImage = 'radial-gradient(circle at 50% 0%, #1e1b4b 0%, #030712 60%)';
        container.style.border = '1px solid rgba(255,255,255,0.05)';
        watermark.className = "text-center pt-6 border-t border-white/5 mt-4 text-[10px] text-slate-500 font-mono";
    }



       // 2. CLEAN PAPER - Pure white with subtle texture
    else if (style === 'paper') {
        container.style.backgroundColor = '#ffffff';
        container.style.backgroundImage = 'none';
        container.style.border = '1px solid #e2e8f0';
        watermark.className = "text-center pt-6 border-t border-gray-100 mt-4 text-[10px] text-gray-400 font-serif italic";
    }else if (style === 'cyber') {
        container.style.backgroundColor = '#000000';
        // Matrix Grid Pattern
        container.style.backgroundImage = `
            linear-gradient(rgba(0, 255, 70, 0.05) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 255, 70, 0.05) 1px, transparent 1px)
        `;
        container.style.backgroundSize = '20px 20px';
        container.style.border = '2px solid #22c55e';
        container.style.boxShadow = '0 0 30px rgba(34, 197, 94, 0.2)';
        
        // Terminal Style Watermark
        watermark.className = "text-center pt-6 border-t border-green-900 mt-4 text-[10px] text-green-600 font-mono";
        // We keep the CMOB text but style it like code
    }  // 3. SKETCHBOOK - Yellow paper with lines
    else if (style === 'notebook') {
        container.style.backgroundColor = '#fef9c3';
        // Notebook lines
        container.style.backgroundImage = 'linear-gradient(#94a3b8 1px, transparent 1px)';
        container.style.backgroundSize = '100% 24px';
        container.style.borderLeft = '30px solid #fca5a5'; // Red margin
        container.style.boxShadow = '5px 5px 15px rgba(0,0,0,0.1)';
        watermark.className = "text-center pt-6 mt-4 text-[12px] text-slate-500 font-hand rotate-1";
    }else if (style === 'blueprint') {
        container.style.backgroundColor = '#172554'; // Blue-950
        // Technical Grid
        container.style.backgroundImage = `
            linear-gradient(rgba(255,255,255,0.1) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255,255,255,0.1) 1px, transparent 1px)
        `;
        container.style.backgroundSize = '20px 20px'; // Precision Grid
        container.style.border = '4px double white';
        container.style.boxShadow = '0 10px 30px rgba(0,0,0,0.5)';
        
        watermark.className = "text-center pt-6 border-t-2 border-white/20 mt-4 text-[10px] text-white/60 font-mono tracking-widest";
    }  // 4. STEALTH - Matte Black/Gray
    else if (style === 'stealth') {
        container.style.backgroundColor = '#171717';
        container.style.border = '1px solid #404040';
        watermark.className = "text-center pt-6 border-t border-neutral-800 mt-4 text-[10px] text-neutral-600 font-bold uppercase tracking-[0.3em]";
    } else if (style === 'rose') {
        container.style.backgroundColor = '#fff1f2'; // Very light pink
        // Polka Dot Pattern
        container.style.backgroundImage = 'radial-gradient(#fecdd3 2px, transparent 2px)';
        container.style.backgroundSize = '25px 25px';
        container.style.borderRadius = '30px'; // Rounded container
        container.style.border = '8px solid white';
        container.style.boxShadow = '0 10px 40px rgba(244, 63, 94, 0.15)';
        
        watermark.className = "text-center pt-6 border-t border-pink-200 mt-4 text-[10px] text-pink-300 font-bold uppercase tracking-widest";
    } // 5. MODERN PRO - Clean Slate
    else if (style === 'pro') {
        container.style.backgroundColor = '#f1f5f9';
        container.style.borderTop = '12px solid #4f46e5'; // Indigo top bar
        watermark.className = "text-center pt-6 border-t border-slate-200 mt-4 text-[10px] text-slate-400 font-bold uppercase";
    }
        
else if (style === 'azure') {
        // Aesthetic Grid + Blue Gradient
        container.style.backgroundColor = '#0f172a';
        container.style.backgroundImage = `
            linear-gradient(135deg, rgba(15, 23, 42, 0.95) 0%, rgba(30, 58, 138, 0.9) 50%, rgba(56, 189, 248, 0.8) 100%),
            linear-gradient(rgba(255,255,255,0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255,255,255,0.03) 1px, transparent 1px)
        `;
        container.style.backgroundSize = '100% 100%, 20px 20px, 20px 20px'; 
        
        container.style.border = '1px solid rgba(255, 255, 255, 0.15)';
        container.style.boxShadow = '0 0 50px rgba(14, 165, 233, 0.3)'; // Premium Cyan Glow
        
        // CMOB WATERMARK (Restored and Styled for Azure)
        watermark.className = "text-center pt-6 border-t border-white/10 mt-4 text-[10px] text-cyan-200/70 font-bold tracking-widest uppercase drop-shadow-sm";
    } 
    
    else if (style === 'maritime') {
        // Signature Deep Navy Blue
        container.style.backgroundColor = '#02040a';
        
        // Nautical Chart / Grid Pattern
        container.style.backgroundImage = `
            linear-gradient(rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            linear-gradient(90deg, rgba(255, 255, 255, 0.03) 1px, transparent 1px),
            radial-gradient(circle at 50% 50%, rgba(30, 58, 138, 0.2) 0%, transparent 60%)
        `;
        container.style.backgroundSize = '40px 40px, 40px 40px, 100% 100%';
        
        // Double Border: White (Inner) + Gold (Outer)
        container.style.border = '4px double white'; 
        container.style.outline = '4px solid #02040a'; // Spacer
        container.style.boxShadow = '0 0 0 6px #fbbf24, 0 20px 60px rgba(0,0,0,0.9)'; // Gold Outer Ring
        container.style.borderRadius = '4px';

        // Watermark
        watermark.className = "text-center pt-6 border-t border-white/10 mt-4 text-[10px] text-white/50 font-bold uppercase tracking-[0.3em] font-serif";
        watermark.innerHTML = '<i class="fa-solid fa-anchor text-[#fbbf24]"></i> POWERED BY CMOB DEPARTMENT <i class="fa-solid fa-anchor text-[#fbbf24]"></i>';
    }
    
    
    else {
            container.style.backgroundColor = 'rgba(3, 7, 18, 0.6)';
            if (blobs) blobs.style.display = 'block';
        }
    }

    // --- CARD RENDERER (ALL DESIGNS) ---
  function generateCardHTML(c, themeColor) {
    const colors = { emerald: '#10b981', amber: '#f59e0b', pink: '#ec4899' };
    const borderCol = colors[themeColor] || '#3b82f6';
    
  // --- 1. CLEAN PAPER (Minimal & Sharp) ---
    if(currentTemplate === 'paper') {
        return `
        <div draggable="true" class="card-draggable bg-white border border-gray-200 p-4 mb-3 shadow-sm hover:shadow-lg hover:border-gray-300 transition-all group">
            <div class="flex justify-between items-start mb-2">
                <span class="font-serif font-bold text-slate-800 text-[16px] leading-tight group-hover:text-black">
                    ${c.subject}
                </span>
                <span class="text-[10px] bg-gray-100 text-gray-500 px-2 py-1 rounded font-medium border border-gray-200">
                    ${c.type}
                </span>
            </div>
            
            <div class="h-px bg-gray-100 w-full my-3"></div>

            <div class="flex justify-between text-[12px] text-gray-500 font-medium">
                <span>${c.time}</span>
                <span class="text-gray-800 font-bold">${c.room}</span>
            </div>
            <div class="mt-1 text-[9px] text-gray-300 text-right">#${c.edp}</div>
        </div>`;
    }

   // TEMPLATE: CYBERPUNK (Premium Glitch)
    if(currentTemplate === 'cyber') {
        return `
        <div draggable="true" class="card-draggable relative overflow-hidden bg-black border border-green-600/50 mb-3 group hover:bg-green-900/10 hover:border-green-400 hover:shadow-[0_0_15px_rgba(34,197,94,0.4)] transition-all duration-200">
            
            <!-- Tech Deco -->
            <div class="absolute top-0 right-0 p-1">
                <div class="w-2 h-2 bg-green-500/50 rounded-full animate-pulse"></div>
            </div>

            <div class="p-4 relative z-10 font-mono">
                <!-- Header -->
                <div class="flex justify-between items-end mb-2 border-b border-green-800 pb-2">
                    <span class="text-[10px] text-green-400 font-bold uppercase">>> ${c.type}</span>
                    <span class="text-[9px] text-green-700">ID:${c.edp}</span>
                </div>

                <!-- Subject -->
                <h4 class="text-green-300 font-bold text-[14px] leading-tight uppercase tracking-wider mb-3 group-hover:text-green-100 group-hover:shadow-[0_0_5px_rgba(34,197,94,0.8)] transition-all">
                    ${c.subject}
                </h4>

                <!-- Data Grid -->
                <div class="grid grid-cols-2 gap-2 text-[10px] text-green-500">
                    <div class="bg-green-900/10 p-1 border border-green-900/50">
                        <span class="opacity-50">T:</span> ${c.time}
                    </div>
                    <div class="bg-green-900/10 p-1 border border-green-900/50 text-right">
                        <span class="opacity-50">LOC:</span> ${c.room}
                    </div>
                </div>
            </div>
        </div>`;
    }

     // --- 2. SKETCHBOOK (Handwritten Style) ---
    if(currentTemplate === 'notebook') {
        return `
        <div draggable="true" class="card-draggable relative bg-white/60 p-3 mb-3 border-b-2 border-slate-300 shadow-sm font-hand text-slate-800 hover:-rotate-1 transition-transform">
             <!-- Tape Effect -->
            <div class="absolute -top-2 left-1/2 -translate-x-1/2 w-16 h-4 bg-yellow-200/50 rotate-2"></div>
            
            <div class="flex justify-between items-end mb-1">
                <span class="text-[14px] font-black underline decoration-red-300 decoration-wavy">
                    ${c.subject}
                </span>
            </div>
            
            <div class="text-[12px] pl-2 border-l-2 border-slate-400/30 mt-2">
                <p>‚è∞ ${c.time}</p>
                <p>üìç ${c.room} <span class="text-[10px] text-slate-400">(${c.type})</span></p>
            </div>
            <div class="absolute bottom-1 right-2 text-[10px] opacity-50">#${c.edp}</div>
        </div>`;
    }

   // TEMPLATE: BLUEPRINT (Technical CAD)
    if(currentTemplate === 'blueprint') {
        return `
        <div draggable="true" class="card-draggable bg-blue-900/80 border-2 border-white/40 p-3 mb-2 font-mono text-white relative hover:bg-blue-800 transition-colors group">
            
            <!-- Corner Markers (CAD Style) -->
            <div class="absolute top-0 left-0 w-2 h-2 border-t-2 border-l-2 border-white"></div>
            <div class="absolute top-0 right-0 w-2 h-2 border-t-2 border-r-2 border-white"></div>
            <div class="absolute bottom-0 left-0 w-2 h-2 border-b-2 border-l-2 border-white"></div>
            <div class="absolute bottom-0 right-0 w-2 h-2 border-b-2 border-r-2 border-white"></div>

            <!-- Header -->
            <div class="flex justify-between items-center border-b border-white/20 pb-1 mb-2 border-dashed">
                <span class="text-[10px] bg-white text-blue-900 font-bold px-1">[${c.type}]</span>
                <span class="text-[9px] opacity-70">REF: ${c.edp}</span>
            </div>

            <!-- Subject -->
            <h4 class="font-bold text-[13px] leading-tight mb-3 uppercase tracking-wider group-hover:underline decoration-white/50 underline-offset-4">
                ${c.subject}
            </h4>

            <!-- Specs -->
            <div class="flex flex-col gap-1 text-[10px] opacity-90 pl-2 border-l border-white/30">
                <div class="flex justify-between">
                    <span>TIME_VAL:</span> <span>${c.time}</span>
                </div>
                <div class="flex justify-between">
                    <span>ROOM_ID:</span> <span>${c.room}</span>
                </div>
            </div>
        </div>`;
    }

   // --- 3. STEALTH DARK (Tactical / No Distractions) ---
    if(currentTemplate === 'stealth') {
        return `
        <div draggable="true" class="card-draggable bg-[#262626] border-l-4 border-neutral-600 p-4 mb-3 hover:bg-[#303030] hover:border-white transition-colors">
            <div class="flex justify-between mb-2">
                <span class="text-[10px] font-bold text-neutral-500 uppercase tracking-widest">EDP ${c.edp}</span>
                <span class="text-[10px] font-bold text-neutral-400 bg-neutral-800 px-1 rounded">${c.type}</span>
            </div>
            
            <h4 class="text-neutral-200 font-bold text-[14px] mb-3 font-mono">
                ${c.subject}
            </h4>

            <div class="flex items-center justify-between text-[11px] text-neutral-400 border-t border-neutral-700 pt-2">
                <span class="flex items-center gap-2"><i class="fa-regular fa-clock"></i> ${c.time}</span>
                <span class="text-neutral-300 font-bold">${c.room}</span>
            </div>
        </div>`;
    }
  // TEMPLATE: SOFT ROSE (Coquette Style)
    if(currentTemplate === 'rose') {
        return `
        <div draggable="true" class="card-draggable bg-white rounded-[20px] p-4 mb-3 border border-pink-100 shadow-sm hover:shadow-pink-200 hover:-translate-y-1 transition-all duration-300 group">
            
            <!-- Cute Ribbon Icon Decor -->
            <div class="absolute -top-1 -right-1 text-pink-200 text-xl rotate-12 group-hover:rotate-6 transition-transform">
                <i class="fa-solid fa-ribbon"></i>
            </div>

            <!-- Header Pill -->
            <div class="flex justify-center mb-3">
                <span class="bg-pink-50 text-pink-400 text-[9px] font-bold px-3 py-1 rounded-full border border-pink-100 uppercase tracking-widest">
                    ${c.type} ‚Ä¢ ${c.edp}
                </span>
            </div>

            <!-- Subject -->
            <h4 class="text-center text-slate-700 font-bold text-[15px] mb-3 leading-tight group-hover:text-pink-500 transition-colors">
                ${c.subject}
            </h4>

            <!-- Footer Info -->
            <div class="flex justify-center gap-3 text-[11px] font-medium text-slate-500 border-t border-pink-50 pt-2">
                <div class="flex items-center gap-1">
                    <i class="fa-regular fa-clock text-pink-300"></i> ${c.time}
                </div>
                <div class="flex items-center gap-1">
                    <i class="fa-solid fa-location-dot text-pink-300"></i> ${c.room}
                </div>
            </div>
        </div>`;
    }

   // --- 4. MODERN PRO (Corporate / Clean) ---
    if(currentTemplate === 'pro') {
        const colors = { emerald: '#10b981', amber: '#f59e0b', pink: '#ec4899', blue: '#3b82f6' };
        const accent = themeColor === 'emerald' ? 'border-emerald-500' : (themeColor === 'amber' ? 'border-amber-500' : 'border-indigo-500');
        
        return `
        <div draggable="true" class="card-draggable bg-white rounded-lg shadow-sm p-4 mb-3 border-l-[6px] ${accent} hover:shadow-md transition-shadow">
            <div class="flex justify-between items-start mb-2">
                <h4 class="text-slate-800 font-extrabold text-[14px] w-3/4">
                    ${c.subject}
                </h4>
                <div class="text-right">
                     <span class="block text-[9px] font-bold text-slate-400 uppercase">${c.type}</span>
                     <span class="block text-[9px] text-slate-300">#${c.edp}</span>
                </div>
            </div>
            
            <div class="flex items-center gap-3 mt-3 text-[11px] font-semibold text-slate-600 bg-slate-50 p-2 rounded">
                <div class="flex items-center gap-1.5 flex-1">
                    <i class="fa-regular fa-clock text-indigo-500"></i> ${c.time}
                </div>
                <div class="w-px h-3 bg-slate-300"></div>
                <div class="flex items-center gap-1.5">
                    ${c.room}
                </div>
            </div>
        </div>`;
    }

// TEMPLATE: AZURE PRO (Aesthetic + Hover Effects)
    if(currentTemplate === 'azure') {
        return `
        <div draggable="true" class="card-draggable relative overflow-hidden rounded-2xl mb-3 group transition-all duration-500 hover:-translate-y-1.5 hover:shadow-[0_15px_30px_-5px_rgba(56,189,248,0.4)]"
             style="background: linear-gradient(160deg, rgba(255, 255, 255, 0.15) 0%, rgba(255, 255, 255, 0.05) 100%); backdrop-filter: blur(15px); border: 1px solid rgba(255,255,255,0.2);">
            
            <!-- STICKERS (With smooth hover states) -->
            <div class="absolute -top-3 -right-3 text-cyan-300/20 text-5xl rotate-12 transition-all duration-700 group-hover:rotate-45 group-hover:text-yellow-300/40 group-hover:scale-110">
                <i class="fa-solid fa-wand-magic-sparkles"></i>
            </div>
            <div class="absolute -bottom-4 -left-2 text-white/10 text-6xl transition-all duration-700 group-hover:-translate-y-2 group-hover:text-white/20">
                <i class="fa-solid fa-cloud"></i>
            </div>

            <!-- CONTENT LAYER -->
            <div class="relative z-10 p-4 flex flex-col h-full">
                
                <!-- Header -->
                <div class="flex items-center justify-between mb-3">
                    <div class="flex items-center gap-1.5 bg-white/20 px-2 py-1 rounded-lg border border-white/10 group-hover:bg-cyan-500/30 transition-colors">
                        <i class="fa-solid fa-tag text-[10px] text-cyan-200"></i>
                        <span class="text-[10px] font-bold text-white tracking-wide uppercase">${c.type}</span>
                    </div>
                    <span class="font-mono text-[9px] text-cyan-100 opacity-70 group-hover:opacity-100 transition-opacity">#${c.edp}</span>
                </div>

                <!-- Subject -->
                <h4 class="text-white font-extrabold text-[15px] leading-tight tracking-wide mb-4 drop-shadow-[0_2px_2px_rgba(0,0,0,0.3)] group-hover:text-cyan-50 transition-colors">
                    ${c.subject}
                </h4>

                <!-- Info Pills -->
                <div class="mt-auto flex flex-col gap-2">
                    <div class="flex items-center gap-2 bg-gradient-to-r from-blue-600/50 to-cyan-600/50 px-3 py-1.5 rounded-lg border border-white/10">
                        <i class="fa-regular fa-clock text-cyan-300 text-[10px]"></i>
                        <span class="text-[11px] font-bold text-white">${c.time}</span>
                    </div>
                    <div class="flex items-center gap-2 bg-white/5 px-3 py-1.5 rounded-lg border border-white/10 group-hover:bg-white/10 transition-colors">
                        <i class="fa-solid fa-location-dot text-pink-400 text-[10px] group-hover:animate-bounce"></i>
                        <span class="text-[11px] font-bold text-blue-50">${c.room}</span>
                    </div>
                </div>
            </div>
            
            <!-- Bottom Accent Glow -->
            <div class="absolute bottom-0 left-0 w-full h-[3px] bg-gradient-to-r from-pink-400 via-cyan-400 to-blue-500 opacity-80 group-hover:opacity-100 group-hover:h-[4px] transition-all"></div>
        </div>`;
    }
    // --- END OF AZURE CARD CODE ---

// TEMPLATE: THE NAVIGATOR (Signature Blue & White)
    if(currentTemplate === 'maritime') {
        return `
        <div draggable="true" class="card-draggable relative overflow-hidden rounded-md mb-3 shadow-lg group transition-all duration-300 hover:-translate-y-1.5 hover:shadow-[0_15px_30px_-5px_rgba(255,255,255,0.1)]">
            
            <!-- BACKGROUND: Navy Blue Body -->
            <div class="absolute inset-0 bg-[#0a192f]"></div>
            
            <!-- STICKER: Faded Map/Globe in Background -->
            <div class="absolute -right-10 top-10 text-white opacity-[0.02] text-9xl rotate-12 pointer-events-none group-hover:rotate-0 transition-transform duration-1000">
                <i class="fa-solid fa-earth-americas"></i>
            </div>

            <!-- DECOR: Gold Shoulder Stripes (Rank) -->
            <div class="absolute left-0 top-0 bottom-0 w-1.5 flex flex-col gap-0.5 bg-[#0a192f] border-r border-[#fbbf24]/30">
                <div class="h-1/3 w-full bg-[#fbbf24]"></div>
                <div class="h-1/3 w-full bg-[#fbbf24]"></div>
                <div class="h-1/3 w-full bg-[#fbbf24]"></div>
            </div>

            <!-- CONTENT LAYER -->
            <div class="relative z-10 flex flex-col h-full ml-2">
                
                <!-- TOP HEADER: Crisp White (The Hat/Shirt) -->
                <div class="bg-white px-4 py-2 flex justify-between items-center border-b-4 border-[#fbbf24]">
                    <div class="flex items-center gap-2">
                         <i class="fa-solid fa-anchor text-[#0a192f] text-[12px]"></i>
                         <span class="text-[#0a192f] text-[11px] font-black uppercase tracking-wider">UC-METC: ${c.edp}</span>
                    </div>
                    <!-- Type Badge -->
                    <span class="text-[9px] font-bold bg-[#0a192f] text-white px-2 py-0.5 rounded shadow-sm">
                        ${c.type}
                    </span>
                </div>

                <!-- BODY: Navy Blue (The Coat) -->
                <div class="p-4 relative">
                    
                    <!-- Floating Sticker: Star -->
                    <div class="absolute top-2 right-2 text-[#fbbf24] text-[10px] animate-pulse">
                        <i class="fa-solid fa-star"></i>
                    </div>

                    <!-- Subject Title -->
                    <h4 class="text-white font-serif font-bold text-[16px] uppercase tracking-wide leading-tight mb-4 group-hover:text-[#fbbf24] transition-colors drop-shadow-md">
                        ${c.subject}
                    </h4>

                    <!-- Dashboard Info -->
                    <div class="grid grid-cols-2 gap-4 border-t border-white/10 pt-3">
                        
                        <!-- Time (Lighthouse Icon) -->
                        <div class="flex flex-col">
                            <span class="text-[9px] text-gray-400 uppercase font-bold mb-0.5 tracking-wider">Watch Time</span>
                            <div class="flex items-center gap-2 text-white text-[11px] font-mono">
                                <i class="fa-solid fa-tower-observation text-[#fbbf24]"></i>
                                ${c.time}
                            </div>
                        </div>

                        <!-- Room (Ship Icon) -->
                        <div class="flex flex-col items-end text-right">
                            <span class="text-[9px] text-gray-400 uppercase font-bold mb-0.5 tracking-wider">Location</span>
                            <div class="flex items-center gap-2 text-white text-[11px] font-mono font-bold">
                                <span>${c.room}</span>
                                <i class="fa-solid fa-ship text-sky-400"></i>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>`;
    }




       // --- 5. COSMIC GLASS (Default - Polished) ---
    // This return statement handles 'cosmic', 'glass', and any unknowns
    return `
    <div draggable="true" class="card-draggable relative overflow-hidden bg-slate-900/40 backdrop-blur-md border border-white/10 rounded-xl p-4 mb-3 group hover:bg-slate-800/50 hover:border-white/20 transition-all shadow-lg">
        <!-- Glow Bar on Left -->
        <div class="absolute left-0 top-0 bottom-0 w-1 bg-gradient-to-b from-blue-500 to-purple-500 shadow-[0_0_10px_rgba(59,130,246,0.5)]"></div>

        <div class="pl-3">
            <div class="flex justify-between items-center mb-2">
                <span class="text-[10px] font-bold text-blue-300 uppercase tracking-widest bg-blue-500/10 px-2 py-0.5 rounded border border-blue-500/20">
                    ${c.type}
                </span>
                <span class="text-[10px] text-slate-500 font-mono group-hover:text-slate-400">
                    ${c.edp}
                </span>
            </div>

            <h4 class="text-white font-bold text-[15px] mb-3 tracking-wide text-shadow">
                ${c.subject}
            </h4>

            <div class="flex flex-col gap-1 text-[12px] text-slate-300 font-medium opacity-90">
                <div class="flex items-center gap-2">
                    <i class="fa-regular fa-clock text-purple-400 text-[10px]"></i>
                    <span>${c.time}</span>
                </div>
                <div class="flex items-center gap-2">
                    <i class="fa-solid fa-location-dot text-purple-400 text-[10px]"></i>
                    <span>${c.room}</span>
                </div>
            </div>
        </div>
    </div>`;
}

    // --- 4. RENDER ENGINE ---
    function renderAll() {
        const container = document.getElementById('resultArea');
        container.innerHTML = ''; container.className = "flex flex-col w-full";
        
        const days = [
            { id: 'mwf', title: 'Mon / Wed / Fri', data: parsedData.mwf, color: 'emerald', hex: '#10b981' },
            { id: 'tth', title: 'Tue / Thu', data: parsedData.tth, color: 'amber', hex: '#f59e0b' },
            { id: 'sat', title: 'Saturday', data: parsedData.sat, color: 'pink', hex: '#ec4899' }
        ];

        days.forEach(dayGroup => {
            if (dayGroup.data.length === 0) return;
            const section = document.createElement('div');
            section.className = "day-section w-full";
            const cols = canvasSettings.mode === 'desktop' ? 3 : canvasSettings.cols;
            section.innerHTML = `
                <div class="day-header flex items-center justify-between border-b border-white/5 pb-2 mb-4">
                    <div class="flex items-center gap-3">
                        <div class="dot-glow" style="background-color: ${dayGroup.hex}; color: ${dayGroup.hex}; width:8px; height:8px; border-radius:50%; box-shadow: 0 0 10px ${dayGroup.hex}"></div>
                        <h2 class="text-[10px] font-black text-slate-300 uppercase tracking-widest">${dayGroup.title}</h2>
                    </div>
                   <span class="text-[13px] font-bold font-mono opacity-80 bg-white/10 px-3 py-1 rounded-lg border border-white/5">${dayGroup.data.length} Class</span>
                </div>
                <div class="card-grid grid grid-cols-${cols} gap-3"></div>
            `;
            const grid = section.querySelector('.card-grid');
            dayGroup.data.sort((a,b)=>a.sort-b.sort).forEach(c => { grid.innerHTML += generateCardHTML(c, dayGroup.color); });
            container.appendChild(section);
        });
        initDragAndDrop();
        syncCanvas();
    }

    // --- 5. SYSTEM LOGIC ---
    function setLayout(mode) {
        canvasSettings.mode = mode;
        const ctrls = document.getElementById('layoutControls');
        const container = document.getElementById('scheduleContainer');
        if (mode === 'desktop') {
            ctrls.classList.add('hidden');
            container.style.width = "100%"; container.style.maxWidth = "1200px";
            container.style.paddingTop = "20px"; document.getElementById('resultArea').style.zoom = "1";
        } else {
            ctrls.classList.remove('hidden'); container.style.maxWidth = "none"; syncCanvas();
        }
        renderAll();
    }

    function adjustCanvas(type, val) {
        canvasSettings[type] = val;
        if (type === 'cols') renderAll();
        else syncCanvas();
    }

    function syncCanvas() {
        const container = document.getElementById('scheduleContainer');
        if (canvasSettings.mode === 'mobile') {
            container.style.width = canvasSettings.width + "px";
            container.style.paddingTop = canvasSettings.top + "px";
            container.style.margin = "0 auto";
            document.getElementById('resultArea').style.zoom = canvasSettings.scale;
        }
    }

    function downloadImage() {
        const element = document.getElementById('scheduleContainer');
        const watermark = document.getElementById('watermark');
        
        // 1. Show Watermark
        watermark.classList.remove('hidden');
        
        // 2. Loading State
        const btn = document.querySelector('button[onclick="downloadImage()"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = `<i class="fa-solid fa-spinner animate-spin"></i> Capturing...`;

        // 3. Calculate Dimensions
        // We use scrollHeight to capture the FULL height, even if it goes off-screen
        const capWidth = canvasSettings.mode === 'mobile' ? parseInt(canvasSettings.width) : element.offsetWidth;
        const capHeight = Math.max(element.scrollHeight, element.offsetHeight, 844); // Ensure at least phone height

        html2canvas(element, {
            // Force the background to cover the whole height
            backgroundColor: currentTemplate === 'paper' || currentTemplate === 'pro' ? '#ffffff' : (currentTemplate === 'cyber' ? '#000000' : '#020617'),
            
            scale: 3, // High Quality
            useCORS: true, 
            allowTaint: true, 
            
            // CRITICAL: Force the canvas to be the full height of content
            width: capWidth, 
            height: capHeight,
            windowHeight: capHeight, 
            
            onclone: (cloned) => {
                const root = cloned.getElementById('scheduleContainer');
                const res = cloned.getElementById('resultArea');
                
                // Ensure the cloned container stretches fully
                root.style.height = capHeight + "px"; 
                root.style.minHeight = capHeight + "px";
                
                // Maintain Zoom
                root.style.zoom = "1"; 
                root.style.width = capWidth + "px";
                
                // Reset Transforms for clear text
                res.style.zoom = "1"; 
                res.style.transform = "none";
                
                // Text Wrapping Fix
                cloned.querySelectorAll('.card-draggable h4').forEach(h4 => {
                    h4.style.whiteSpace = "normal"; 
                    h4.style.overflow = "visible";
                });
            }
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `UC_Schedule_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png", 1.0);
            link.click();
            
            // Reset Button
            btn.innerHTML = originalText; 
            watermark.classList.add('hidden');
        });
    }

    // PDF, Drag & Drop, and Init Utils...
    async function handlePDF(input) {
        const file = input.files[0];
        if (!file) return;
        const labelSpan = document.getElementById('pdfLabel');
        labelSpan.innerHTML = `<i class="fa-solid fa-spinner animate-spin"></i> Reading...`;
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                let items = textContent.items.sort((a, b) => {
                    if (Math.abs(a.transform[5] - b.transform[5]) > 4) return b.transform[5] - a.transform[5];
                    return a.transform[4] - b.transform[4];
                });
                let lastY = -1; let lastX = -1;
                for (let item of items) {
                    let cX = item.transform[4]; let cY = item.transform[5];
                    if (lastY !== -1 && Math.abs(cY - lastY) > 4) fullText += "\n";
                    else if (lastX !== -1 && (cX - lastX) > 6) fullText += " ";
                    fullText += item.str; lastY = cY; lastX = cX + (item.width || 0);
                }
            }
            document.getElementById('rawInput').value = fullText;
            labelSpan.innerHTML = `<i class="fa-solid fa-check"></i> Loaded!`;
        } catch (e) { alert("PDF Error: " + e.message); }
    }

  function processSchedule() {
    let raw = document.getElementById('rawInput').value;
    if (!raw.trim()) { alert("Paste text first!"); return; }

    localStorage.setItem('uc_schedule_data', raw);
    parsedData = { mwf: [], tth: [], sat: [] };

    // --- STEP 1: CLEAN THE WEIRD CHARACTERS ---
    let cleanRaw = raw
        .replace(/\t/g, ' ')
        // 1. THIS IS THE KEY FIX: Replace the weird "Ratio" symbol with a normal Colon
        .replace(/‚à∂/g, ':') 
        .replace(/Ôºö/g, ':') // Just in case full-width colon exists too
        
        // 2. Fix Dash types
        .replace(/‚Äì|‚Äî/g, '-')
        
        // 3. Fix "Stuck" Time (e.g. 1:30PM -> 1:30 PM)
        .replace(/(\d{1,2}:\d{2})([AP]M)/gi, '$1 $2')
        .replace(/([AP]M)-(\d)/gi, '$1 - $2')
        
        // 4. Collapse spaces
        .replace(/\s+/g, ' ');

    const lines = cleanRaw.split(/(?=\b\d{5}\b)/); // Split by EDP

    let successCount = 0;

    lines.forEach(line => {
        line = line.trim();

        // MATCH: EDP (5 digits) ... TIME (00:00 AM/PM)
        const edpMatch = line.match(/^(\d{5})\b/);
        // Updated Regex to be very flexible with the time format
        const timeMatch = line.match(/(\d{1,2}:\d{2}\s*[AP]M\s*-\s*\d{1,2}:\d{2}\s*[AP]M)/i);

        if (edpMatch && timeMatch) {
            const edp = edpMatch[1];
            const time = timeMatch[0];

            // DETECT DAYS
            let days = "MWF"; 
            if (line.match(/\b(TTH|TUE|THU|TH)\b/i)) days = "TTH";
            else if (line.match(/\b(SAT|S)\b/i) && !line.match(/Subject|Status/i)) days = "SAT";
            else if (line.match(/\b(MWF|MW|M|W|F)\b/i)) days = "MWF";

            // DETECT TYPE
            let type = "LEC";
            if (line.match(/\s(L|LAB|LB)\s/)) type = "LAB";

            // EXTRACT SUBJECT (Between EDP and Time)
            // We strip out the specific junk found in your log (Units "3", "2", "1")
            let middleChunk = line.substring(5, line.indexOf(time)).trim();
            
            let subject = middleChunk
                .replace(/\b(MWF|TTH|SAT|MW|T|TH|S)\b/gi, '') // Remove Days
                .replace(/\b(L|LAB|LEC)\b/g, '')             // Remove Type letter
                .replace(/\b\d\b/g, '')                      // Remove the "3", "2", "1" units
                .replace(/\s+/g, ' ')                        // Clean spaces
                .trim();

            // EXTRACT ROOM (After time)
            let afterTime = line.substring(line.indexOf(time) + time.length).trim();
            let room = afterTime.split(' ')[0] || "TBA";
            // Ignore "BSIT" or "BSCS" if it gets picked up as a room
            if (room.length < 2 || room === "BSIT" || room === "BSCS") room = "TBA";

            // ASSIGN
            let group = 'mwf';
            if (days.includes('TTH')) group = 'tth';
            if (days.includes('SAT')) group = 'sat';

            parsedData[group].push({
                edp,
                subject,
                time,
                room,
                type,
                sort: parseTime(time.split('-')[0])
            });
            successCount++;
        }
    });

    if (successCount > 0) {
        document.getElementById('toolbar').classList.remove('hidden');
        document.getElementById('emptyState').classList.add('hidden');
        document.getElementById('resultArea').classList.remove('hidden');
        document.getElementById('fabCustomize').classList.remove('hidden');
        setLayout('desktop');
        
        const label = document.getElementById('pdfLabel');
        if(label) label.innerHTML = `<i class="fa-solid fa-check text-green-400"></i> Success`;
    } else {
        console.log("Still Failed Raw:", raw); // Keep logging just in case
        alert("Still failing. Please check console.");
    }
}

    function parseTime(t) {
        let [time, mod] = t.split(/([AP]M)/i);
        let [h, m] = time.trim().split(':').map(Number);
        if(h === 12) h = 0; if(mod.toUpperCase() === 'PM') h += 12;
        return h * 60 + m;
    }

    function initDragAndDrop() {
        const draggables = document.querySelectorAll('.card-draggable');
        const grids = document.querySelectorAll('.card-grid');
        draggables.forEach(d => {
            d.addEventListener('dragstart', () => d.classList.add('dragging'));
            d.addEventListener('dragend', () => d.classList.remove('dragging'));
        });
        grids.forEach(g => {
            g.addEventListener('dragover', e => {
                e.preventDefault();
                const draggable = document.querySelector('.dragging');
                const afterElement = getDragAfterElement(g, e.clientY);
                if (afterElement == null) g.appendChild(draggable);
                else g.insertBefore(draggable, afterElement);
            });
        });
    }

    function getDragAfterElement(container, y) {
        const elements = [...container.querySelectorAll('.card-draggable:not(.dragging)')];
        return elements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset, element: child };
            else return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

  function changeTheme(dept) {
    const theme = themes[dept];
    const root = document.documentElement;
    
    // 1. Update the CSS Variables (This changes the Glows and Blobs)
    root.style.setProperty('--theme-primary', theme.primary);
    root.style.setProperty('--theme-secondary', theme.secondary);
    
    // 2. Save the choice
    localStorage.setItem('uc_theme', dept);
    
    // 3. Update the Generate Button glow manually for extra punch
    const btn = document.getElementById('genBtn');
    btn.style.boxShadow = `0 10px 30px -10px ${theme.primary}88`; // 88 is transparency
    
    // 4. Refresh the schedule colors
    renderAll();
}

    function changeDensity(val) { canvasSettings.cols = val; renderAll(); }
    function openTemplateModal() { document.getElementById('templateModal').classList.remove('hidden'); }
    function closeTemplateModal() { document.getElementById('templateModal').classList.add('hidden'); }
    function clearData() { if(confirm("Clear data?")) { localStorage.removeItem('uc_schedule_data'); location.reload(); } }
    function toggleVideo() { document.getElementById('videoModal').classList.toggle('hidden'); }
    function loadExample() {
        document.getElementById('rawInput').value = `41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM A2-404\n17192 IT-ELECT2 2 SAT 8:30 AM - 10:30 AM M1`;
        processSchedule();
    }








    function switchTab(mode) {
    const vMob = document.getElementById('view-mobile');
    const vDesk = document.getElementById('view-desktop');
    const bMob = document.getElementById('btn-mobile');
    const bDesk = document.getElementById('btn-desktop');
    
    // Pause videos when switching tabs
    const vidMob = document.getElementById('vid-mobile');
    const vidDesk = document.getElementById('vid-desktop');
    if (vidMob) vidMob.pause();
    if (vidDesk) vidDesk.pause();

    if (mode === 'mobile') {
        vMob.classList.remove('hidden');
        vDesk.classList.add('hidden');
        bMob.className = "glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg transition-all";
        bDesk.className = "glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg transition-all";
    } else {
        vDesk.classList.remove('hidden');
        vMob.classList.add('hidden');
        bDesk.className = "glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg transition-all";
        bMob.className = "glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg transition-all";
    }
}
</script>
</body>
</html> 
