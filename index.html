<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC Schedule | Sorter AI</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=JetBrains+Mono:wght@400;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Outfit"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'fade-up': 'fadeUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #030712; color: white; overflow-x: hidden; }
        
        /* Background Animation */
        .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .shape { position: absolute; filter: blur(90px); opacity: 0.4; animation: blob 10s infinite cubic-bezier(0.4, 0, 0.2, 1); }
        .shape-1 { top: -10%; left: -10%; width: 600px; height: 600px; background: #4f46e5; }
        .shape-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: #db2777; animation-delay: 2s; }
        
        /* Glass Effects */
        .glass-panel { background: rgba(17, 24, 39, 0.7); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3); }
        .glass-btn { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(5px); transition: all 0.3s ease; }
        .glass-btn:hover { background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.3); transform: translateY(-2px); }
        
        textarea:focus { outline: none; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #0f172a; }
        ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .text-gradient { background: linear-gradient(to right, #60a5fa, #c084fc); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

        /* Tabs */
        .tab-active { background-color: #3b82f6; color: white; border-color: transparent; }
        .tab-inactive { background-color: transparent; color: #94a3b8; border: 1px solid #334155; }
    </style>
</head>
<body class="selection:bg-indigo-500 selection:text-white">

    <!-- 1. DYNAMIC NEWS BAR (Remote Control) -->
    <div id="news-bar" class="hidden w-full bg-blue-600 text-white text-center py-2 text-sm font-bold animate-pulse z-50 relative shadow-lg">
        <span id="news-text">Loading updates...</span>
        <button onclick="this.parentElement.style.display='none'" class="absolute right-4 top-1.5 text-white/70 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
    </div>

    <div class="ambient-light">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <main class="max-w-7xl mx-auto px-4 py-10 md:py-16">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6 animate-fade-up">
            <div class="relative">
                <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight mb-2">
                    Study Load <br> <span class="text-gradient">Sorter AI</span>
                </h1>
                <p class="text-slate-400 font-light text-lg">Kapoy Manual?, gamita ni, fast and simple gamiton.</p>
            </div>
            
            <div class="flex gap-3">
                <button onclick="toggleVideo()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2 group">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <span class="text-sm font-semibold tracking-wide text-slate-300 group-hover:text-white">Watch Tutorial</span>
                </button>
                <button onclick="loadExample()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2">
                    <i class="fa-solid fa-code text-blue-400"></i>
                    <span class="text-sm font-semibold tracking-wide text-slate-300">Load Example</span>
                </button>
            </div>
        </header>

        <!-- Input Section -->
        <div class="glass-panel rounded-3xl p-1 mb-16 animate-fade-up" style="animation-delay: 0.1s;">
            <div class="bg-[#0f172a]/60 rounded-[20px] p-6 md:p-10 relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>

                <div class="flex justify-between items-center mb-4">
                    <label class="text-xs font-bold uppercase tracking-[0.2em] text-blue-400">Paste Schedule Table</label>
                    <div class="flex gap-2">
                        <button onclick="clearData()" class="text-[10px] bg-red-500/10 border border-red-500/30 text-red-400 px-3 py-1 rounded hover:bg-red-500/20 transition">
                            <i class="fa-solid fa-trash"></i> Clear Saved
                        </button>
                        <div class="text-[10px] bg-slate-800 border border-slate-700 px-2 py-1 rounded text-slate-400 font-mono">
                            CTRL + V
                        </div>
                    </div>
                </div>

                <textarea id="rawInput" class="w-full h-40 bg-transparent resize-none text-sm md:text-base font-mono text-slate-200 placeholder-slate-600 border-b border-slate-700 focus:border-blue-500 transition-colors" 
                placeholder="Paste directly from your study load...&#10;41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM"></textarea>

                <div class="mt-8 flex justify-end">
                    <button onclick="processSchedule()" class="relative overflow-hidden bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-10 rounded-xl transition-all hover:shadow-[0_0_30px_rgba(37,99,235,0.4)] active:scale-95 group">
                        <span class="relative z-10 flex items-center gap-2">
                            Generate Schedule <i class="fa-solid fa-bolt"></i>
                        </span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Output Grid -->
        <div id="resultArea" class="hidden grid grid-cols-1 md:grid-cols-3 gap-8">
            <!-- MWF -->
            <div class="space-y-4 animate-fade-up" style="animation-delay: 0.2s;">
                <div class="flex items-center gap-3 pb-2 border-b border-white/5">
                    <div class="w-3 h-3 rounded-full bg-emerald-400 shadow-[0_0_10px_#34d399]"></div>
                    <h2 class="font-bold text-xl text-slate-200">Mon / Wed / Fri</h2>
                    <span id="cnt-mwf" class="ml-auto text-xs font-mono text-emerald-400 bg-emerald-400/10 px-2 py-1 rounded">0</span>
                </div>
                <div id="list-mwf" class="space-y-4"></div>
            </div>

            <!-- TTH -->
            <div class="space-y-4 animate-fade-up" style="animation-delay: 0.3s;">
                <div class="flex items-center gap-3 pb-2 border-b border-white/5">
                    <div class="w-3 h-3 rounded-full bg-amber-400 shadow-[0_0_10px_#fbbf24]"></div>
                    <h2 class="font-bold text-xl text-slate-200">Tue / Thu</h2>
                    <span id="cnt-tth" class="ml-auto text-xs font-mono text-amber-400 bg-amber-400/10 px-2 py-1 rounded">0</span>
                </div>
                <div id="list-tth" class="space-y-4"></div>
            </div>

            <!-- SAT -->
            <div class="space-y-4 animate-fade-up" style="animation-delay: 0.4s;">
                <div class="flex items-center gap-3 pb-2 border-b border-white/5">
                    <div class="w-3 h-3 rounded-full bg-pink-400 shadow-[0_0_10px_#f472b6]"></div>
                    <h2 class="font-bold text-xl text-slate-200">Saturday</h2>
                    <span id="cnt-sat" class="ml-auto text-xs font-mono text-pink-400 bg-pink-400/10 px-2 py-1 rounded">0</span>
                </div>
                <div id="list-sat" class="space-y-4"></div>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-20 opacity-30 animate-pulse">
            <i class="fa-solid fa-layer-group text-6xl mb-4 text-slate-400"></i>
            <p class="text-slate-400 text-sm tracking-widest uppercase">Waiting for data...</p>
        </div>

    </main>

    <!-- NEW: DUAL TAB VIDEO MODAL -->
    <div id="videoModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md p-4 transition-opacity duration-300">
        <div class="absolute inset-0" onclick="toggleVideo()"></div>
        <div class="glass-panel w-full max-w-4xl rounded-2xl overflow-hidden relative z-10 transform scale-95 opacity-0 transition-all duration-300" id="modalContent">
            
            <!-- Modal Header -->
            <div class="flex justify-between items-center p-5 border-b border-white/10 bg-white/5">
                <h3 class="font-bold text-white flex items-center gap-2">
                    <i class="fa-solid fa-play-circle text-blue-500"></i> How to Use
                </h3>
                <button onclick="toggleVideo()" class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white/10 text-slate-400 hover:text-white">
                    <i class="fa-solid fa-xmark"></i>
                </button>
            </div>

            <!-- TABS -->
            <div class="flex p-2 bg-slate-900/50 gap-2 border-b border-white/5">
                <button onclick="switchTab('mobile')" id="btn-mobile" class="glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg text-center transition-all">
                    <i class="fa-solid fa-mobile-screen mr-2"></i> Mobile
                </button>
                <button onclick="switchTab('desktop')" id="btn-desktop" class="glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg text-center transition-all">
                    <i class="fa-solid fa-desktop mr-2"></i> Desktop
                </button>
            </div>

            <!-- VIDEO CONTAINER -->
            <div class="p-4 bg-black/40">
                
                <!-- MOBILE VIEW -->
                <div id="view-mobile">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-mobile" class="w-full h-full object-contain" controls playsinline>
                            <!-- MOBILE VIDEO FILE -->
                            <source src="mon.mp4" type="video/mp4">
                            <p class="text-slate-500 text-sm flex items-center justify-center h-full">File 'mobile_tutorial.mp4' not found.</p>
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Open PDF > Select All > Copy > Paste Here.</p>
                </div>

                <!-- DESKTOP VIEW (Hidden) -->
                <div id="view-desktop" class="hidden">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-desktop" class="w-full h-full object-contain" controls playsinline>
                            <!-- DESKTOP VIDEO FILE -->
                            <source src="2026-01-20 12-21-41.mp4" type="video/mp4">
                            <p class="text-slate-500 text-sm flex items-center justify-center h-full">File 'desktop_tutorial.mp4' not found.</p>
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Portal > Ctrl+A > Ctrl+C > Paste Here.</p>
                </div>

            </div>
        </div>
    </div>

    <script>
        // --- CONFIGURATION ---
        const REMOTE_DB_URL = ""; 

        // --- 1. SYSTEM INIT ---
        window.onload = function() {
            const savedData = localStorage.getItem('uc_schedule_data');
            if(savedData) {
                document.getElementById('rawInput').value = savedData;
                processSchedule();
            }
            if(REMOTE_DB_URL) checkRemoteUpdates();
        }

        async function checkRemoteUpdates() {
            try {
                const response = await fetch(REMOTE_DB_URL);
                const data = await response.json();
                if (data.show_announcement) {
                    const bar = document.getElementById('news-bar');
                    document.getElementById('news-text').innerText = data.announcement;
                    bar.classList.remove('hidden');
                    if(data.color === 'red') {
                        bar.classList.remove('bg-blue-600');
                        bar.classList.add('bg-red-600');
                    }
                }
            } catch (e) { console.log("No updates found"); }
        }

        // --- 2. VIDEO TAB LOGIC ---
        function switchTab(mode) {
            const mobileView = document.getElementById('view-mobile');
            const desktopView = document.getElementById('view-desktop');
            const mobileBtn = document.getElementById('btn-mobile');
            const desktopBtn = document.getElementById('btn-desktop');
            
            // Pause videos
            document.getElementById('vid-mobile').pause();
            document.getElementById('vid-desktop').pause();

            if (mode === 'mobile') {
                mobileView.classList.remove('hidden');
                desktopView.classList.add('hidden');
                
                mobileBtn.classList.add('tab-active');
                mobileBtn.classList.remove('tab-inactive');
                
                desktopBtn.classList.remove('tab-active');
                desktopBtn.classList.add('tab-inactive');
            } else {
                desktopView.classList.remove('hidden');
                mobileView.classList.add('hidden');

                desktopBtn.classList.add('tab-active');
                desktopBtn.classList.remove('tab-inactive');

                mobileBtn.classList.remove('tab-active');
                mobileBtn.classList.add('tab-inactive');
            }
        }

        function toggleVideo() {
            const modal = document.getElementById('videoModal');
            const content = document.getElementById('modalContent');

            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    content.classList.remove('scale-95', 'opacity-0');
                    content.classList.add('scale-100', 'opacity-100');
                }, 10);
            } else {
                content.classList.remove('scale-100', 'opacity-100');
                content.classList.add('scale-95', 'opacity-0');
                // Pause All
                document.getElementById('vid-mobile').pause();
                document.getElementById('vid-desktop').pause();
                setTimeout(() => { modal.classList.add('hidden'); }, 300);
            }
        }

        // --- 3. DATA MANAGEMENT ---
        function clearData() {
            if(confirm("Clear your saved schedule?")) {
                localStorage.removeItem('uc_schedule_data');
                document.getElementById('rawInput').value = '';
                location.reload();
            }
        }

        // --- 4. THE SCANNER ENGINE ---
        function processSchedule() {
            const raw = document.getElementById('rawInput').value;
            if(!raw.trim()) {
                const box = document.querySelector('textarea').parentElement;
                box.classList.add('animate-pulse');
                setTimeout(() => box.classList.remove('animate-pulse'), 500);
                return;
            }

            // Auto-Save
            localStorage.setItem('uc_schedule_data', raw);

            const data = { mwf: [], tth: [], sat: [] };
            const lines = raw.split('\n');
            
            lines.forEach(line => {
                let cleanLine = line.replace(/\t/g, ' ').trim();
                
                // STRICT FILTER: 5 Digits EDP
                const edpMatch = cleanLine.match(/^(\d{5})/);
                if (!edpMatch) return; 
                const edpCode = edpMatch[1];

                const timeRegex = /(\d{1,2}:\d{2}\s?[AP]M)\s?[-â€“]\s?(\d{1,2}:\d{2}\s?[AP]M)/i;
                const dayRegex = /(MWF|MW|TTH|SAT|FRI|TUE|THU)/i;
                
                const timeMatch = cleanLine.match(timeRegex);
                const dayMatch = cleanLine.match(dayRegex);

                if(timeMatch && dayMatch) {
                    const fullTime = timeMatch[0];
                    const startTime = timeMatch[1];
                    const day = dayMatch[0].toUpperCase();
                    
                    let middlePart = cleanLine.replace(edpCode, '').split(dayMatch[0])[0].trim();
                    let parts = middlePart.split(/\s+/);
                    
                    if(parts.length > 0 && /^\d$/.test(parts[parts.length-1])) parts.pop();

                    let lastWord = parts[parts.length-1];
                    let type = "LEC"; 
                    if(lastWord && ['LAB','LEC','L'].includes(lastWord)) {
                        type = lastWord === 'L' ? 'LAB' : lastWord;
                        parts.pop();
                    }
                    const subject = parts.join(" ");

                    const afterTime = cleanLine.split(fullTime)[1] || "";
                    let room = afterTime.trim().split(/\s{2,}/)[0] || afterTime.trim().split(/\s+/)[0] || "TBA";
                    room = room.replace(/[^a-zA-Z0-9-]/g, '');

                    const item = {
                        edp: edpCode,
                        subject: subject,
                        time: fullTime,
                        room: room,
                        sort: parseTime(startTime),
                        type: type
                    };

                    if(day.includes("SAT")) data.sat.push(item);
                    else if(day.includes("T") || day.includes("H")) data.tth.push(item);
                    else data.mwf.push(item);
                }
            });

            // SORTING
            const sorter = (a, b) => a.sort - b.sort;
            data.mwf.sort(sorter);
            data.tth.sort(sorter);
            data.sat.sort(sorter);

            document.getElementById('emptyState').classList.add('hidden');
            document.getElementById('resultArea').classList.remove('hidden');

            renderColumn('list-mwf', 'cnt-mwf', data.mwf, 'emerald');
            renderColumn('list-tth', 'cnt-tth', data.tth, 'amber');
            renderColumn('list-sat', 'cnt-sat', data.sat, 'pink');
        }

        function renderColumn(listId, countId, items, colorName) {
            const list = document.getElementById(listId);
            const count = document.getElementById(countId);
            list.innerHTML = '';
            count.innerText = items.length;

            if(items.length === 0) {
                list.innerHTML = `<div class="p-4 border border-dashed border-white/10 rounded-xl text-center text-slate-500 text-xs italic">No classes</div>`;
                return;
            }

            items.forEach((c, index) => {
                const delay = index * 100;
                
                const card = `
                <div class="glass-panel p-5 rounded-2xl relative overflow-hidden group hover:-translate-y-1 transition-transform duration-300 animate-fade-up" style="animation-delay: ${delay}ms; animation-fill-mode: backwards;">
                    <div class="absolute left-0 top-0 bottom-0 w-1 bg-${colorName}-400"></div>
                    
                    <div class="pl-2">
                        <div class="flex justify-between items-start mb-3">
                            <div>
                                <div class="inline-block bg-blue-600 shadow-[0_0_15px_rgba(37,99,235,0.5)] text-white text-[11px] font-mono font-bold px-2 py-0.5 rounded mb-1 tracking-widest">
                                    ${c.edp}
                                </div>
                                <h3 class="font-bold text-lg leading-tight text-white group-hover:text-${colorName}-300 transition-colors">${c.subject}</h3>
                            </div>
                            <span class="text-[10px] font-bold tracking-wider px-2 py-0.5 rounded bg-white/5 text-slate-300 border border-white/10">${c.type}</span>
                        </div>

                        <div class="flex items-center gap-2 text-sm text-${colorName}-300 mb-1">
                            <i class="fa-regular fa-clock"></i>
                            <span class="font-medium">${c.time}</span>
                        </div>
                        
                        <div class="flex items-center gap-2 text-xs text-slate-400">
                            <i class="fa-solid fa-location-dot text-slate-500"></i>
                            <span class="font-mono">${c.room}</span>
                        </div>
                    </div>
                </div>`;
                list.innerHTML += card;
            });
        }

        function parseTime(t) {
            let [time, mod] = t.split(/\s+/);
            if(!mod) { mod = t.includes('PM') ? 'PM' : 'AM'; time = t.replace(/[AP]M/,''); }
            let [h, m] = time.split(':').map(Number);
            if(h === 12) h = 0;
            if(mod.toUpperCase() === 'PM') h += 12;
            return h * 60 + m;
        }

        function loadExample() {
            const ex = `EDP Code Subject Type Units Days Time Room
41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM A2-404 BSIT
17192 IT-ELECT2 2 SAT 8:30 AM - 10:30 AM M1 BSIT
17200 IT-ELECT2 L 1 SAT 10:30 AM - 1:30 PM C1 BSIT
17128 IT-SYSADMN32 LAB 1 MWF 11:30 AM - 12:30 PM C1 BSIT`;
            document.getElementById('rawInput').value = ex;
        }
    </script>
</body>
</html>