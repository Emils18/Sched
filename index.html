<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UC Schedule Sorter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- HTML2CANVAS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Fonts -->
 <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=JetBrains+Mono:wght@400;700&family=Gloria+Hallelujah&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">


<!-- PDF.js (Matched Versions) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>



    <script>


   tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['"Plus Jakarta Sans"', 'sans-serif'],
                        mono: ['"JetBrains Mono"', 'monospace'],
                        // NEW FONTS ADDED HERE:
                        hand: ['"Gloria Hallelujah"', 'cursive'],
                        cyber: ['"Orbitron"', 'sans-serif'],
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'bounce-slow': 'bounce 3s infinite', // Added for the floating button
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        },
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }






        
    </script>
  <style>
    /* --- 1. GLOBAL & AMBIENT GLOW --- */
    body { background-color: #030712; color: white; overflow-x: hidden; font-family: 'Plus Jakarta Sans', sans-serif; }
    :root { --theme-primary: #3b82f6; --theme-secondary: #a855f7; }

    .ambient-light { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
    .shape { position: absolute; filter: blur(100px); opacity: 0.4; animation: blob 10s infinite alternate; }
    .shape-1 { top: -10%; left: -10%; width: 600px; height: 600px; background: var(--theme-primary); }
    .shape-2 { bottom: -10%; right: -10%; width: 500px; height: 500px; background: var(--theme-secondary); }

    /* --- 2. BUTTONS VISIBILITY FIX --- */
    .glass-btn { 
        background: rgba(255, 255, 255, 0.1) !important; 
        border: 1px solid rgba(255, 255, 255, 0.2) !important; 
        backdrop-filter: blur(10px);
        transition: all 0.3s ease;
    }
    .glass-btn:hover { background: rgba(255, 255, 255, 0.2) !important; border-color: white !important; }

    /* --- 3. THE ARTBOARD --- */
    #scheduleContainer {
        margin: 0 auto !important;
        background-color: rgba(3, 7, 18, 0.4); 
        position: relative;
        display: block !important; 
        transition: width 0.3s ease;
        box-sizing: border-box;
        padding: 25px;
        border-radius: 32px;
    }

    /* --- 4. CARDS (Large Text Fix) --- */
    .card-draggable { 
        padding: 16px !important;
        border-radius: 20px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    /* SUBJECT NAME: Increased to 16px for clarity */
    .card-draggable h4 {
        font-size: 16px !important;
        font-weight: 800 !important;
        letter-spacing: -0.02em;
        line-height: 1.2;
        margin: 8px 0 !important;
        white-space: normal !important;
    }

    /* EDP TAG: Increased to 12px */
    .edp-tag {
        font-family: 'JetBrains Mono', monospace;
        font-size: 12px !important;
        font-weight: 800;
        padding: 4px 10px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.15);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }

    /* INFO TEXT (Time/Room): 13px */
    .info-text { font-size: 13px !important; font-weight: 500; opacity: 1 !important; }

    .day-header { border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px; margin-bottom: 20px; }
    .card-grid { display: grid !important; gap: 15px; align-items: stretch; }

















    /* Dynamic Header Glow */
.header-glow {
    text-shadow: 0 0 30px var(--theme-primary);
    transition: all 0.5s ease;
}

/* Dynamic Generate Button */
#genBtn {
    background: linear-gradient(135deg, var(--theme-primary), var(--theme-secondary)) !important;
    box-shadow: 0 10px 20px -10px var(--theme-primary);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

#genBtn:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: 0 20px 40px -10px var(--theme-primary);
}

#genBtn:active {
    transform: scale(0.95);
}

/* Smooth Title Gradient */
.text-gradient {
    background: linear-gradient(to right, var(--theme-primary), var(--theme-secondary));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    transition: all 0.8s ease;
}
</style>



</head>
<body class="selection:bg-indigo-500 selection:text-white min-h-screen flex flex-col">

    <div class="ambient-light">
        <div class="shape shape-1"></div>
        <div class="shape shape-2"></div>
    </div>

    <!-- Main Content Wrapper -->
    <main class="flex-grow max-w-7xl mx-auto px-4 py-10 md:py-16 w-full">
        
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-end mb-12 gap-6 animate-fade-up">
            <div class="relative">
                <h1 class="text-5xl md:text-6xl font-extrabold tracking-tight mb-2">
                    Study Load <br> <span class="text-gradient header-glow">Sorter AI</span>
                </h1>
                <p class="text-slate-400 font-light text-lg">Paste text. Choose design. Save image.</p>
            </div>
            
<!-- PDF UPLOAD BUTTON -->
      <label class="cursor-pointer glass-btn px-5 py-3 rounded-full flex items-center gap-2 group">
                <i class="fa-solid fa-file-pdf text-red-500"></i>
                <span id="pdfLabel" class="text-sm font-semibold tracking-wide text-slate-300 group-hover:text-white">Upload PDF</span>
                <input type="file" id="pdfUpload" accept=".pdf" class="hidden" onchange="handlePDF(this)">
            </label>



            <div class="flex gap-3">
                <button onclick="toggleVideo()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2 group">
                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse"></div>
                    <span class="text-sm font-semibold tracking-wide text-slate-300 group-hover:text-white">Watch Tutorial</span>
                </button>
                <button onclick="loadExample()" class="glass-btn px-5 py-3 rounded-full flex items-center gap-2">
                    <i class="fa-solid fa-code text-blue-400"></i>
                    <span class="text-sm font-semibold tracking-wide text-slate-300">Sample</span>
                </button>
            </div>
        </header>

        <!-- Input Section -->
        <div class="glass-panel rounded-3xl p-1 mb-16 animate-fade-in">
            <div class="bg-[#0f172a]/60 rounded-[20px] p-6 md:p-10 relative overflow-hidden group">
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500 opacity-0 group-focus-within:opacity-100 transition-opacity duration-500"></div>

                <div class="flex justify-between items-center mb-4">
                    <label class="text-xs font-bold uppercase tracking-[0.2em] text-slate-400">Paste Schedule Table</label>
                    <div class="flex gap-2">
                        <button onclick="clearData()" class="text-[10px] bg-red-500/10 border border-red-500/30 text-red-400 px-3 py-1 rounded hover:bg-red-500/20 transition">
                            <i class="fa-solid fa-trash"></i> Clear
                        </button>
                        <div class="text-[10px] bg-slate-800 border border-slate-700 px-2 py-1 rounded text-slate-400 font-mono">
                            CTRL + V
                        </div>
                    </div>
                </div>

                <textarea id="rawInput" class="w-full h-40 bg-transparent resize-none text-sm md:text-base font-mono text-slate-200 placeholder-slate-600 border-b border-slate-700 focus:border-blue-500 transition-colors" 
                placeholder="Paste directly from your study load...&#10;41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM"></textarea>

                <div class="mt-8 flex justify-end">
                    <button id="genBtn" onclick="processSchedule()" class="relative overflow-hidden text-white font-black py-4 px-12 rounded-2xl transition-all uppercase tracking-widest group">
    <span class="relative z-10 flex items-center gap-3">
        Generate <i class="fa-solid fa-bolt animate-pulse"></i>
    </span>
</button>
                </div>
            </div>
        </div>

        <!-- CONTROL BAR (Design & Department) -->
        <div id="toolbar" class="hidden mb-8 animate-fade-in">
            <div class="glass-panel p-4 rounded-xl flex flex-col xl:flex-row justify-between items-center gap-4">
                
                <!-- Department Theme -->
                <div class="flex items-center gap-2 w-full xl:w-auto">
                    <span class="text-xs font-bold text-slate-400 uppercase">Dept:</span>
                    <select id="deptSelect" onchange="changeTheme(this.value)" class="bg-slate-800 text-white text-sm rounded-lg p-2 border border-slate-600 focus:ring-blue-500 focus:border-blue-500 flex-1">
                        <option value="BSIT">BSIT / CCS</option>
                        <option value="MARITIME">Maritime</option>
                        <option value="ENGINEERING">Engineering</option>
                        <option value="CUSTOMS">Customs</option>
                        <option value="EDUCATION">Education</option>
                    </select>
                </div>

                <!-- Design Picker -->
                <div class="flex items-center gap-2 w-full xl:w-auto bg-slate-900/50 p-1 rounded-lg">


<div class="flex items-center gap-2 w-full xl:w-auto bg-slate-900/50 p-1 rounded-lg">
    <button onclick="setLayout('desktop')" id="btn-mode-pc" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow">
        Desktop View
    </button>
    <button onclick="setLayout('mobile')" id="btn-mode-mobile" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white">
        Mobile Designer
    </button>
</div>

                    <button onclick="setDesign('glass')" id="btn-glass" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow">
                        <i class="fa-regular fa-gem mr-1"></i> Glass
                    </button>
                    <button onclick="setDesign('paper')" id="btn-paper" class="flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400 hover:text-white">
                        <i class="fa-regular fa-file-lines mr-1"></i> Paper
                    </button>
                  
                </div>

           <!-- ADVANCED WALLPAPER DESIGNER -->
<div id="layoutControls" class="hidden flex flex-col gap-4 w-full xl:w-auto bg-slate-900/90 p-5 rounded-3xl border border-white/10 backdrop-blur-xl mb-6">
    <!-- 1. Layout Density -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Layout Density</label>
        <div class="flex bg-black/40 p-1 rounded-xl gap-1">
            <button onclick="changeDensity(1)" id="den-1" class="flex-1 py-1.5 text-[10px] font-bold rounded-lg text-slate-400">List</button>
            <button onclick="changeDensity(2)" id="den-2" class="flex-1 py-1.5 text-[10px] font-bold rounded-lg bg-blue-600 text-white shadow">Grid</button>
        </div>
    </div>
    <!-- 2. Card Size -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Zoom Cards</label>
        <input type="range" min="0.5" max="1" step="0.05" value="0.9" class="cursor-pointer accent-emerald-500" oninput="adjustCanvas('scale', this.value)">
    </div>
    <!-- 3. Canvas Width -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Wallpaper Width</label>
        <input type="range" min="350" max="600" value="450" class="cursor-pointer accent-purple-500" oninput="adjustCanvas('width', this.value)">
    </div>
    <!-- 4. Clock Space -->
    <div class="flex flex-col gap-1">
        <label class="text-[9px] text-slate-500 uppercase font-bold">Top Space (Clock)</label>
        <input type="range" min="0" max="300" value="80" class="cursor-pointer accent-blue-500" oninput="adjustCanvas('top', this.value)">
    </div>
</div>




                <!-- Download -->
                <button onclick="downloadImage()" class="w-full xl:w-auto bg-green-600 hover:bg-green-500 text-white font-bold py-2 px-6 rounded-lg shadow-lg flex items-center justify-center gap-2 transition">
                    <i class="fa-solid fa-download"></i> Save Image
                </button>
            </div>
        </div>

        <!-- Output Grid (The part that gets saved) -->
        <div id="scheduleContainer" class="p-4 rounded-2xl bg-[#030712] relative transition-colors duration-500">
            <div id="resultArea" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 pb-8">
                <!-- Columns injected by JS -->
            </div>

            <!-- WATERMARK -->
            <div id="watermark" class="hidden text-center pt-6 border-t border-slate-800/50 mt-4">
                <p class="text-[10px] text-slate-500 font-mono uppercase tracking-widest">
                    <i class="fa-solid fa-microchip mr-1"></i> Powered by CMOB Department
                </p>
            </div>
        </div>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-20 opacity-30 animate-pulse">
            <i class="fa-solid fa-layer-group text-6xl mb-4 text-slate-400"></i>
            <p class="text-slate-400 text-sm tracking-widest uppercase">Waiting for data...</p>
        </div>

    </main>






 <!-- NEW: FLOATING CUSTOMIZE BUTTON -->
    <button id="fabCustomize" onclick="openTemplateModal()" class="hidden fixed bottom-6 right-6 w-14 h-14 bg-purple-600 hover:bg-purple-500 text-white rounded-full shadow-2xl z-50 flex items-center justify-center text-xl transition hover:scale-110 active:scale-90 animate-bounce">
        <i class="fa-solid fa-palette"></i>
    </button>

    <!-- NEW: TEMPLATE GALLERY MODAL -->
    <div id="templateModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md p-4">
        <div class="absolute inset-0" onclick="closeTemplateModal()"></div>
        <div class="glass w-full max-w-4xl h-[80vh] rounded-2xl flex flex-col relative z-10">
            <div class="p-5 border-b border-white/10 flex justify-between items-center">
                <h3 class="font-bold text-xl text-white">Select a Design Style</h3>
                <button onclick="closeTemplateModal()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
        <div class="flex-1 overflow-y-auto p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6">
    <!-- Cosmic -->
    <div onclick="setDesign('cosmic')" class="cursor-pointer group">
        <div class="bg-[#030712] border border-blue-500/50 h-32 rounded-xl flex items-center justify-center font-bold text-white group-hover:ring-2 ring-blue-500 transition">Cosmic Glass</div>
        <p class="text-xs text-center text-slate-400 mt-2">Default Dark Mode</p>
    </div>
    <!-- Clean Paper -->
    <div onclick="setDesign('paper')" class="cursor-pointer group">
        <div class="bg-white border border-gray-300 h-32 rounded-xl flex items-center justify-center font-bold text-gray-800 group-hover:ring-2 ring-gray-400 transition shadow-lg">Clean Paper</div>
        <p class="text-xs text-center text-slate-400 mt-2">Minimalist Light</p>
    </div>
    <!-- Cyberpunk -->
    <div onclick="setDesign('cyber')" class="cursor-pointer group">
        <div class="bg-black border-2 border-green-500 h-32 flex items-center justify-center font-bold text-green-500 font-mono group-hover:shadow-[0_0_15px_#22c55e] transition">CYBERPUNK</div>
        <p class="text-xs text-center text-slate-400 mt-2">High Contrast Neon</p>
    </div>
    <!-- Sketchbook -->
   <div onclick="setDesign('notebook')" class="cursor-pointer group">
    <div class="bg-[#fef9c3] h-32 rounded-xl border border-yellow-600 flex items-center justify-center text-slate-700 font-serif border-l-[20px] border-l-red-300">Sketchbook</div>
    <p class="text-xs text-center text-slate-500 mt-2">Handwritten Style</p>
</div>
<div onclick="setDesign('blueprint')" class="cursor-pointer group">
    <div class="bg-[#1e3a8a] h-32 rounded-xl border-4 border-double border-white flex items-center justify-center text-white font-mono" style="background-image: radial-gradient(white 0.5px, transparent 0.5px); background-size: 10px 10px;">Blueprint</div>
    <p class="text-xs text-center text-slate-500 mt-2">Technical Grid</p>
</div>
<div onclick="setDesign('stealth')" class="cursor-pointer group">
    <div class="bg-black h-32 rounded-xl border border-white/20 flex items-center justify-center text-slate-400 font-bold">Stealth Dark</div>
    <p class="text-xs text-center text-slate-500 mt-2">Minimalist Dark</p>
</div>
<div onclick="setDesign('rose')" class="cursor-pointer group">
    <div class="bg-[#fff1f2] h-32 rounded-full border border-rose-200 flex items-center justify-center text-rose-400 font-bold">Soft Rose</div>
    <p class="text-xs text-center text-slate-500 mt-2">Aesthetic Light</p>
</div>
<div onclick="setDesign('pro')" class="cursor-pointer group">
    <div class="bg-white h-32 rounded-xl border-t-8 border-blue-600 shadow-lg flex items-center justify-center text-slate-800 font-black">Modern Pro</div>
    <p class="text-xs text-center text-slate-500 mt-2">Clean Professional</p>
</div>
</div>

     </div>
    </div>














    <!-- FOOTER -->
    <footer class="border-t border-slate-800/50 py-8 bg-[#020617] relative z-10">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="text-slate-400 text-sm font-medium">
                Powered by 
                <span class="ml-1 font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-500">
                    <i class="fa-solid fa-microchip mr-1"></i> CMOB Department
                </span>
            </p>
            <p class="text-[10px] text-slate-600 mt-2 font-mono">&copy; 2026. Built for UC Students.</p>
        </div>
    </footer>

    <!-- VIDEO MODAL -->
    <div id="videoModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/90 backdrop-blur-md p-4 transition-opacity duration-300">
        <div class="absolute inset-0" onclick="toggleVideo()"></div>
        <div class="glass-panel w-full max-w-4xl rounded-2xl overflow-hidden relative z-10">
            <div class="flex justify-between items-center p-5 border-b border-white/10 bg-white/5">
                <h3 class="font-bold text-white">How to Use</h3>
                <button onclick="toggleVideo()" class="text-slate-400 hover:text-white"><i class="fa-solid fa-xmark text-lg"></i></button>
            </div>
            <div class="flex p-2 bg-slate-900/50 gap-2 border-b border-white/5">
                <button onclick="switchTab('mobile')" id="btn-mobile" class="glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg">Mobile</button>
                <button onclick="switchTab('desktop')" id="btn-desktop" class="glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg">Desktop</button>
            </div>
            <div class="p-4 bg-black/40">
                <div id="view-mobile">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-mobile" class="w-full h-full object-contain" controls playsinline>
                            <source src="mon.mp4" type="video/mp4">
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Open PDF > Copy Text > Paste Here.</p>
                </div>
                <div id="view-desktop" class="hidden">
                    <div class="aspect-video bg-black rounded-lg overflow-hidden border border-slate-700 mb-3 relative">
                        <video id="vid-desktop" class="w-full h-full object-contain" controls playsinline>
                            <source src="2026-01-20 12-21-41.mp4" type="video/mp4">
                        </video>
                    </div>
                    <p class="text-xs text-slate-400 text-center font-mono">Tip: Portal > Copy (Ctrl+C) > Paste (Ctrl+V).</p>
                </div>
            </div>
        </div>
    </div>

        <script>
    // --- GLOBAL STATE ---
    let currentTemplate = 'cosmic';
    let parsedData = { mwf: [], tth: [], sat: [] };
    let studentName = "UC Student";
    let canvasSettings = { width: 420, cols: 2, scale: 0.9, top: 80, mode: 'desktop' };

    const themes = {
        BSIT: { primary: '#3b82f6', secondary: '#a855f7', button: 'bg-blue-600' },
        MARITIME: { primary: '#0ea5e9', secondary: '#1e3a8a', button: 'bg-sky-600' },
        ENGINEERING: { primary: '#f97316', secondary: '#dc2626', button: 'bg-orange-600' },
        CUSTOMS: { primary: '#10b981', secondary: '#0f766e', button: 'bg-emerald-600' },
        EDUCATION: { primary: '#ec4899', secondary: '#be123c', button: 'bg-pink-600' }
    };

    // --- DESIGN ENGINE ---
    function setDesign(style) {
        if (style === 'glass') style = 'cosmic';
        currentTemplate = style;
        
        // Update Indicator
        ['glass', 'paper'].forEach(id => {
            const btn = document.getElementById(`btn-${id}`);
            if (btn) btn.className = (id === style || (id === 'glass' && style === 'cosmic')) ? 
                "flex-1 px-4 py-1.5 text-xs font-bold rounded-md bg-blue-600 text-white shadow" : 
                "flex-1 px-4 py-1.5 text-xs font-bold rounded-md text-slate-400";
        });

        updateContainerStyle(style);
        renderAll();
        if(typeof closeTemplateModal === 'function') closeTemplateModal();
    }

    function applyTemplate(style) { setDesign(style); }

    function updateContainerStyle(style) {
        const container = document.getElementById('scheduleContainer');
        const watermark = document.getElementById('watermark');
        const blobs = document.querySelector('.ambient-light');

        container.style = ""; 
        container.className = "p-4 rounded-2xl relative overflow-hidden transition-all duration-500";
        if (blobs) blobs.style.display = 'block';

        if (style === 'paper') {
            container.style.backgroundColor = '#ffffff';
            watermark.className = "text-center pt-6 border-t border-gray-200 mt-4 text-[10px] text-gray-400 font-bold uppercase";
        } else if (style === 'cyber') {
            container.style.backgroundColor = '#000000';
            container.style.border = '2px solid #22c55e';
            watermark.className = "text-center pt-6 border-t border-green-900 mt-4 text-[10px] text-green-500 font-mono";
        } else if (style === 'notebook') {
            container.style.backgroundColor = '#fef9c3';
            container.style.backgroundImage = 'linear-gradient(#94a3b8 1px, transparent 1px)';
            container.style.backgroundSize = '100% 25px';
            container.style.borderLeft = '40px solid #fecaca';
        } else if (style === 'blueprint') {
            container.style.backgroundColor = '#172554';
            container.style.backgroundImage = 'radial-gradient(#3b82f6 0.5px, transparent 0.5px)';
            container.style.backgroundSize = '15px 15px';
            container.style.border = '4px double white';
        } else if (style === 'stealth') {
            container.style.backgroundColor = '#0a0a0a';
            container.style.border = '1px solid #334155';
        } else if (style === 'rose') {
            container.style.backgroundColor = '#fff1f2';
        } else if (style === 'pro') {
            container.style.backgroundColor = '#f8fafc';
            container.style.borderTop = '10px solid #2563eb';
        } else {
            container.style.backgroundColor = 'rgba(3, 7, 18, 0.6)';
            if (blobs) blobs.style.display = 'block';
        }
    }

    // --- CARD RENDERER (ALL DESIGNS) ---
  function generateCardHTML(c, themeColor) {
    const colors = { emerald: '#10b981', amber: '#f59e0b', pink: '#ec4899' };
    const borderCol = colors[themeColor] || '#3b82f6';
    
    // TEMPLATE 1: PAPER (Clean & Large)
    if(currentTemplate === 'paper') {
        return `<div draggable="true" class="card-draggable bg-white border-2 border-gray-100 shadow-md mb-1 text-gray-800">
            <div class="flex justify-between items-center mb-2">
                <span class="edp-tag" style="background:#f1f5f9; color:#1e293b; border-color:#cbd5e1">${c.edp}</span>
                <span class="text-[10px] font-bold text-gray-400 uppercase">${c.type}</span>
            </div>
            <h4 style="color:#0f172a">${c.subject}</h4>
            <div class="mt-2 text-[12px] text-gray-500 font-medium border-t pt-2">
                <div><i class="fa-regular fa-clock"></i> ${c.time}</div>
                <div><i class="fa-solid fa-location-dot"></i> ${c.room}</div>
            </div>
        </div>`;
    } 

    // TEMPLATE 2: CYBERPUNK (Neon Highlight)
    if(currentTemplate === 'cyber') {
        return `<div draggable="true" class="card-draggable bg-black border-2 border-green-500 p-3 mb-1 text-green-400 font-cyber shadow-[0_0_15px_rgba(34,197,94,0.3)]">
            <div class="flex justify-between items-center mb-2">
                <span class="edp-tag" style="border-color:#22c55e; color:#22c55e">${c.edp}</span>
                <span class="text-[10px] font-black uppercase">>> ${c.type}</span>
            </div>
            <h4 class="text-white">${c.subject}</h4>
            <p class="text-[11px] mt-2 font-mono opacity-90">LOC: ${c.room} | ${c.time}</p>
        </div>`;
    }

    // TEMPLATE 3: SKETCHBOOK (Handwritten but Bold)
    if(currentTemplate === 'notebook') {
        return `<div draggable="true" class="card-draggable bg-white/60 border-b-4 border-blue-200 -rotate-1 mb-2 text-blue-900 font-hand shadow-sm">
            <div class="flex justify-between items-center mb-1">
                <span class="text-xs font-bold underline decoration-red-400">${c.edp}</span>
                <span class="text-[10px] opacity-60">${c.type}</span>
            </div>
            <h4 class="text-blue-900 font-black">${c.subject}</h4>
            <p class="text-[12px] mt-1">${c.time} @ ${c.room}</p>
        </div>`;
    }

    // TEMPLATE 4: BLUEPRINT (Technical)
    if(currentTemplate === 'blueprint') {
        return `<div draggable="true" class="card-draggable border-2 border-white/40 bg-blue-600/20 p-3 mb-1 font-mono text-white">
            <div class="flex justify-between mb-2">
                <span class="edp-tag" style="background:#fff; color:#1e3a8a">${c.edp}</span>
                <span class="text-[10px]">[${c.type}]</span>
            </div>
            <h4 class="text-white font-bold underline decoration-white/30">${c.subject}</h4>
            <p class="text-[11px] mt-2 opacity-90">${c.time} | RM:${c.room}</p>
        </div>`;
    }

    // TEMPLATE 5: STEALTH DARK (High Contrast)
    if(currentTemplate === 'stealth') {
        return `<div draggable="true" class="card-draggable bg-[#111] border border-white/10 p-4 mb-1 text-slate-100 shadow-2xl">
            <div class="flex justify-between items-center mb-2">
                <span class="edp-tag" style="border-color:#334155; background:#000">${c.edp}</span>
                <span class="text-[10px] font-bold text-slate-500">${c.type}</span>
            </div>
            <h4 class="text-white">${c.subject}</h4>
            <div class="mt-2 text-[12px] text-slate-400 flex flex-col gap-1">
                <span><i class="fa-regular fa-clock"></i> ${c.time}</span>
                <span><i class="fa-solid fa-location-dot"></i> ${c.room}</span>
            </div>
        </div>`;
    }

    // TEMPLATE 6: SOFT ROSE (Pill Shape)
    if(currentTemplate === 'rose') {
        return `<div draggable="true" class="card-draggable bg-white/90 p-4 rounded-[2.5rem] border border-rose-100 shadow-sm mb-1 text-center">
            <span class="text-[11px] font-black text-rose-300 tracking-tighter">EDP ${c.edp}</span>
            <h4 class="text-rose-500 font-extrabold uppercase">${c.subject}</h4>
            <p class="text-rose-400 text-[11px] font-medium italic">${c.time} â€¢ ${c.room}</p>
        </div>`;
    }

    // TEMPLATE 7: MODERN PRO (The Sharpest Look)
    if(currentTemplate === 'pro') {
        return `<div draggable="true" class="card-draggable bg-white p-4 border-l-8 shadow-lg mb-1 flex flex-col" style="border-left-color: ${borderCol}">
            <div class="flex justify-between items-center mb-2">
                <span class="edp-tag" style="background:#1e293b; border:none">${c.edp}</span>
                <span class="text-[10px] font-black text-gray-300 uppercase">${c.type}</span>
            </div>
            <h4 class="text-slate-900 font-black tracking-tighter">${c.subject}</h4>
            <p class="text-slate-500 text-[12px] mt-2 font-bold uppercase"><i class="fa-regular fa-clock"></i> ${c.time} | ${c.room}</p>
        </div>`;
    }

    // DEFAULT: POLISHED COSMIC GLASS (Based on Image 2)
    return `
    <div draggable="true" class="card-draggable glass-panel relative overflow-hidden flex flex-col border border-white/10 hover:border-white/20 transition-all shadow-xl">
        <div class="absolute left-0 top-0 bottom-0 w-1.5" style="background-color: ${borderCol}; box-shadow: 0 0 15px ${borderCol}"></div>
        
        <div class="flex justify-between items-center mb-2">
            <span class="edp-tag" style="background:rgba(255,255,255,0.05); border-color:${borderCol}88">${c.edp}</span>
            <span class="text-[10px] font-bold text-slate-400 uppercase tracking-widest">${c.type}</span>
        </div>

        <h4 class="text-white uppercase tracking-tight">${c.subject}</h4>

        <div class="mt-auto pt-3 flex flex-col gap-1.5">
            <div class="info-text text-slate-300">
                <i class="fa-regular fa-clock text-blue-400"></i>
                <span>${c.time.replace('-', ' - ')}</span>
            </div>
            <div class="info-text text-slate-300">
                <i class="fa-solid fa-location-dot text-slate-500"></i>
                <span class="font-mono font-bold">${c.room}</span>
            </div>
        </div>
    </div>`;
}

    // --- 4. RENDER ENGINE ---
    function renderAll() {
        const container = document.getElementById('resultArea');
        container.innerHTML = ''; container.className = "flex flex-col w-full";
        
        const days = [
            { id: 'mwf', title: 'Mon / Wed / Fri', data: parsedData.mwf, color: 'emerald', hex: '#10b981' },
            { id: 'tth', title: 'Tue / Thu', data: parsedData.tth, color: 'amber', hex: '#f59e0b' },
            { id: 'sat', title: 'Saturday', data: parsedData.sat, color: 'pink', hex: '#ec4899' }
        ];

        days.forEach(dayGroup => {
            if (dayGroup.data.length === 0) return;
            const section = document.createElement('div');
            section.className = "day-section w-full";
            const cols = canvasSettings.mode === 'desktop' ? 3 : canvasSettings.cols;
            section.innerHTML = `
                <div class="day-header flex items-center justify-between border-b border-white/5 pb-2 mb-4">
                    <div class="flex items-center gap-3">
                        <div class="dot-glow" style="background-color: ${dayGroup.hex}; color: ${dayGroup.hex}; width:8px; height:8px; border-radius:50%; box-shadow: 0 0 10px ${dayGroup.hex}"></div>
                        <h2 class="text-[10px] font-black text-slate-300 uppercase tracking-widest">${dayGroup.title}</h2>
                    </div>
                   <span class="text-[13px] font-bold font-mono opacity-80 bg-white/10 px-3 py-1 rounded-lg border border-white/5">${dayGroup.data.length} Class</span>
                </div>
                <div class="card-grid grid grid-cols-${cols} gap-3"></div>
            `;
            const grid = section.querySelector('.card-grid');
            dayGroup.data.sort((a,b)=>a.sort-b.sort).forEach(c => { grid.innerHTML += generateCardHTML(c, dayGroup.color); });
            container.appendChild(section);
        });
        initDragAndDrop();
        syncCanvas();
    }

    // --- 5. SYSTEM LOGIC ---
    function setLayout(mode) {
        canvasSettings.mode = mode;
        const ctrls = document.getElementById('layoutControls');
        const container = document.getElementById('scheduleContainer');
        if (mode === 'desktop') {
            ctrls.classList.add('hidden');
            container.style.width = "100%"; container.style.maxWidth = "1200px";
            container.style.paddingTop = "20px"; document.getElementById('resultArea').style.zoom = "1";
        } else {
            ctrls.classList.remove('hidden'); container.style.maxWidth = "none"; syncCanvas();
        }
        renderAll();
    }

    function adjustCanvas(type, val) {
        canvasSettings[type] = val;
        if (type === 'cols') renderAll();
        else syncCanvas();
    }

    function syncCanvas() {
        const container = document.getElementById('scheduleContainer');
        if (canvasSettings.mode === 'mobile') {
            container.style.width = canvasSettings.width + "px";
            container.style.paddingTop = canvasSettings.top + "px";
            container.style.margin = "0 auto";
            document.getElementById('resultArea').style.zoom = canvasSettings.scale;
        }
    }

    function downloadImage() {
        const element = document.getElementById('scheduleContainer');
        const watermark = document.getElementById('watermark');
        watermark.classList.remove('hidden');
        const btn = document.querySelector('button[onclick="downloadImage()"]');
        const originalText = btn.innerHTML;
        btn.innerHTML = `<i class="fa-solid fa-spinner animate-spin"></i> Capturing...`;

        const capWidth = canvasSettings.mode === 'mobile' ? parseInt(canvasSettings.width) : element.offsetWidth;

        html2canvas(element, {
            backgroundColor: currentTemplate === 'paper' || currentTemplate === 'pro' ? '#ffffff' : (currentTemplate === 'cyber' ? '#000000' : '#030712'),
            scale: 4, useCORS: true, allowTaint: true, width: element.offsetWidth, height: element.offsetHeight,
            onclone: (cloned) => {
                const root = cloned.getElementById('scheduleContainer');
                const res = cloned.getElementById('resultArea');
                root.style.zoom = "1"; root.style.width = capWidth + "px";
                res.style.zoom = "1"; res.style.transform = "none";
                cloned.querySelectorAll('.card-draggable h4').forEach(h4 => {
                    h4.style.whiteSpace = "normal"; h4.style.overflow = "visible";
                });
            }
        }).then(canvas => {
            const link = document.createElement('a');
            link.download = `UC_Schedule_${Date.now()}.png`;
            link.href = canvas.toDataURL("image/png",1.0);
            link.click();
            btn.innerHTML = originalText; watermark.classList.add('hidden');
        });
    }

    // PDF, Drag & Drop, and Init Utils...
    async function handlePDF(input) {
        const file = input.files[0];
        if (!file) return;
        const labelSpan = document.getElementById('pdfLabel');
        labelSpan.innerHTML = `<i class="fa-solid fa-spinner animate-spin"></i> Reading...`;
        try {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            let fullText = "";
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                let items = textContent.items.sort((a, b) => {
                    if (Math.abs(a.transform[5] - b.transform[5]) > 4) return b.transform[5] - a.transform[5];
                    return a.transform[4] - b.transform[4];
                });
                let lastY = -1; let lastX = -1;
                for (let item of items) {
                    let cX = item.transform[4]; let cY = item.transform[5];
                    if (lastY !== -1 && Math.abs(cY - lastY) > 4) fullText += "\n";
                    else if (lastX !== -1 && (cX - lastX) > 6) fullText += " ";
                    fullText += item.str; lastY = cY; lastX = cX + (item.width || 0);
                }
            }
            document.getElementById('rawInput').value = fullText;
            labelSpan.innerHTML = `<i class="fa-solid fa-check"></i> Loaded!`;
        } catch (e) { alert("PDF Error: " + e.message); }
    }

   function processSchedule() {
    const raw = document.getElementById('rawInput').value;
    if (!raw.trim()) return;
    localStorage.setItem('uc_schedule_data', raw);
    parsedData = { mwf: [], tth: [], sat: [] };
    
    const cleanRaw = raw.replace(/(\d)\s+(?=\d)/g, '$1').replace(/(\w)\s*-\s*(\w)/g, '$1-$2');
    const lines = cleanRaw.split('\n');
    
    lines.forEach(line => {
        const edpMatch = line.match(/\b\d{5}\b/);
        const timeMatch = line.match(/(\d{1,2}:\d{2}\s*[AP]M-\d{1,2}:\d{2}\s*[AP]M)/i);
        
        if (edpMatch && timeMatch) {
            const edp = edpMatch[0]; 
            const time = timeMatch[0].toUpperCase();
            const dayMatch = line.match(/\b(MWF|TTH|SAT|MW|TUE|THU|FRI|M|W|F|T|S|TH)\b/i);
            const days = dayMatch ? dayMatch[0].toUpperCase() : "MWF";
            
            // 1. Isolate the part before the time to find the Type (LEC/LAB)
            const partBeforeTime = line.split(time)[0].toUpperCase();
            
            // 2. SURGICAL TYPE DETECTION 
            // \b means "Exact Word". This prevents "C1" or "M1" from being caught as "L"
            let type = "LEC";
            if (/\b(LAB|L|LB)\b/.test(partBeforeTime)) {
                type = "LAB";
            }

            let subject = line.split(days)[0].replace(edp, '').replace(/\s*\d\s*$/, '').trim();
            
            // Clean subject: Remove the "L" or "LAB" word if it's stuck to the subject name
            subject = subject.replace(/\b(LAB|L|LB|LEC)\b/gi, '').trim();

            let room = (line.split(time)[1] || "").trim().split(/\s+/)[0] || "TBA";
            let group = days.includes('TTH') || /^(T|TH|TUE|THU)$/.test(days) ? 'tth' : (days.includes('SAT') ? 'sat' : 'mwf');

            parsedData[group].push({ 
                edp, 
                subject, 
                time, 
                room, 
                type, // This is now 100% accurate
                sort: parseTime(time.split('-')[0]) 
            });
        }
    });

    document.getElementById('toolbar').classList.remove('hidden');
    document.getElementById('emptyState').classList.add('hidden');
    document.getElementById('resultArea').classList.remove('hidden');
    document.getElementById('fabCustomize').classList.remove('hidden');
    setLayout('desktop');
}

    function parseTime(t) {
        let [time, mod] = t.split(/([AP]M)/i);
        let [h, m] = time.trim().split(':').map(Number);
        if(h === 12) h = 0; if(mod.toUpperCase() === 'PM') h += 12;
        return h * 60 + m;
    }

    function initDragAndDrop() {
        const draggables = document.querySelectorAll('.card-draggable');
        const grids = document.querySelectorAll('.card-grid');
        draggables.forEach(d => {
            d.addEventListener('dragstart', () => d.classList.add('dragging'));
            d.addEventListener('dragend', () => d.classList.remove('dragging'));
        });
        grids.forEach(g => {
            g.addEventListener('dragover', e => {
                e.preventDefault();
                const draggable = document.querySelector('.dragging');
                const afterElement = getDragAfterElement(g, e.clientY);
                if (afterElement == null) g.appendChild(draggable);
                else g.insertBefore(draggable, afterElement);
            });
        });
    }

    function getDragAfterElement(container, y) {
        const elements = [...container.querySelectorAll('.card-draggable:not(.dragging)')];
        return elements.reduce((closest, child) => {
            const box = child.getBoundingClientRect();
            const offset = y - box.top - box.height / 2;
            if (offset < 0 && offset > closest.offset) return { offset, element: child };
            else return closest;
        }, { offset: Number.NEGATIVE_INFINITY }).element;
    }

  function changeTheme(dept) {
    const theme = themes[dept];
    const root = document.documentElement;
    
    // 1. Update the CSS Variables (This changes the Glows and Blobs)
    root.style.setProperty('--theme-primary', theme.primary);
    root.style.setProperty('--theme-secondary', theme.secondary);
    
    // 2. Save the choice
    localStorage.setItem('uc_theme', dept);
    
    // 3. Update the Generate Button glow manually for extra punch
    const btn = document.getElementById('genBtn');
    btn.style.boxShadow = `0 10px 30px -10px ${theme.primary}88`; // 88 is transparency
    
    // 4. Refresh the schedule colors
    renderAll();
}

    function changeDensity(val) { canvasSettings.cols = val; renderAll(); }
    function openTemplateModal() { document.getElementById('templateModal').classList.remove('hidden'); }
    function closeTemplateModal() { document.getElementById('templateModal').classList.add('hidden'); }
    function clearData() { if(confirm("Clear data?")) { localStorage.removeItem('uc_schedule_data'); location.reload(); } }
    function toggleVideo() { document.getElementById('videoModal').classList.toggle('hidden'); }
    function loadExample() {
        document.getElementById('rawInput').value = `41200 CC-TECHNO32 3 MWF 3:30 PM - 4:30 PM A2-404\n17192 IT-ELECT2 2 SAT 8:30 AM - 10:30 AM M1`;
        processSchedule();
    }








    function switchTab(mode) {
    const vMob = document.getElementById('view-mobile');
    const vDesk = document.getElementById('view-desktop');
    const bMob = document.getElementById('btn-mobile');
    const bDesk = document.getElementById('btn-desktop');
    
    // Pause videos when switching tabs
    const vidMob = document.getElementById('vid-mobile');
    const vidDesk = document.getElementById('vid-desktop');
    if (vidMob) vidMob.pause();
    if (vidDesk) vidDesk.pause();

    if (mode === 'mobile') {
        vMob.classList.remove('hidden');
        vDesk.classList.add('hidden');
        bMob.className = "glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg transition-all";
        bDesk.className = "glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg transition-all";
    } else {
        vDesk.classList.remove('hidden');
        vMob.classList.add('hidden');
        bDesk.className = "glass-btn tab-active flex-1 py-3 text-sm font-bold rounded-lg transition-all";
        bMob.className = "glass-btn tab-inactive flex-1 py-3 text-sm font-bold rounded-lg transition-all";
    }
}
</script>
</body>
</html> 
